
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Spring Boot ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªä½œæˆ</title>
<title>Spring Boot Development Reference</title>
</head>
<body id="Tutorial" class="book toc2 toc-left">
<div id="header">
<h1>Spring Boot ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªä½œæˆ</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#env">1. ç’°å¢ƒæ•´å‚™</a>
<ul class="sectlevel2">
<li><a href="#apiclient">1.1 APIå®Ÿè¡Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</a>
<li><a href="#ide">1.2 çµ±åˆé–‹ç™ºç’°å¢ƒ</a>
</ul>
<li><a href="#createproj">2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ</a>
<li><a href="#commitproj">3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒŸãƒƒãƒˆ</a>
<li><a href="#importproj">4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</a>
<li><a href="#createapi">5. REST APIã®ä½œæˆ</a>
<ul>
    <li><a href="#initset">5.1 åˆæœŸè¨­å®š</a>
    <ul>
        <li><a href="#configurepom">5.1.1 pom.xmlã®è¨­å®š</a>
        <li><a href="#configureyaml">5.1.2 application.yamlã®è¨­å®š</a>
    </ul>
    <li><a href="#createpkg">5.2. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã®ä½œæˆ</a>
    <li><a href="#createsrcfld">5.3. ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ</a>
    <li><a href="#createtodo">5.4. Todoã‚¯ãƒ©ã‚¹ã®ä½œæˆ</a>
    <li><a href="#createtodoresrc">5.5. TodoResourceã‚¯ãƒ©ã‚¹ã®ä½œæˆ</a>
    <li><a href="#createtorepo">5.6. Repositoryã‚¯ãƒ©ã‚¹ã®ä½œæˆ</a>
    <ul>
        <li><a href="#createtable">5.6.1 ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ</a>
        <li><a href="#createtodorepository">5.6.2 TodoRepositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½œæˆ</a>
        <li><a href="#testrepo">5.6.3 Repositoryã®å˜ä½“ãƒ†ã‚¹ãƒˆ</a>
        <ul>
            <li><a href="#createinitdata">5.6.3.1 åˆæœŸãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ</a>
            <li><a href="#createtest">5.6.3.2 Spring Testã®æ¨™æº–æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ãŸTestã®å®Ÿè£…</a> 
            <li><a href="#dotest">5.6.3.3 RepositoryTestã®å®Ÿè¡Œ</a>
        </ul>
    </ul>
    <li><a href="#createservice">5.7. Serviceã‚¯ãƒ©ã‚¹ã®ä½œæˆ</a>

</ul>

</div>
</div>
<div id="content">
<h2 id="env"><a class="anchor" href="#env"></a>1. ç’°å¢ƒæ•´å‚™</h2>
<p>ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ç’°å¢ƒæ§‹ç¯‰ã‚’ä»¥ä¸‹ã®æ‰‹é †ã§è¡Œã†ã€‚</p>
</div>
<ul class="sectlevel1">
<h3 id="apiclient"><a class="anchor" href="#apicliect"></a>1.1 APIå®Ÿè¡Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</h3>
<p> 
    APIå®Ÿè¡Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã¯Talent API Testerã‚’åˆ©ç”¨ã™ã‚‹ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
</p>
</ul>
<ul class="sectlevel1">
<ol>
    <li type=I>
        <a href="https://chrome.google.com/webstore/detail/talend-api-tester-free-ed/aejoelaoggembcahagimdiliamlcdmfm?hl=ja">
            Talemt API Testerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã«ã‚¢ã‚¯ã‚»ã‚¹
        </a>
    </li>
    <li type=I>
        ç”»é¢å³ä¸Šã®ã€ŒChromeã«è¿½åŠ ã€ã‚’æŠ¼ä¸‹ã€‚
    </li>
    <li type=I>
        Chromeã«æ­£å¸¸ã«è¿½åŠ ã•ã‚ŒãŸã‚‰ã€ç”»é¢å³ä¸Šã®æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚ˆã‚ŠTalent API Testerã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚
    </li>
    <li type=I>
        ãƒªã‚¯ã‚¨ã‚¹ãƒˆç”Ÿæˆç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰å‹•ä½œç¢ºèªå®Œäº†ã€‚
    </li>
</ol>
</ul>
<ul>
<h3 id="ide"><a class="anchor" href="#ide"></a>1.2 çµ±åˆé–‹ç™ºç’°å¢ƒ</h3>
<p>çµ±åˆé–‹ç™ºç’°å¢ƒã«ã¯ã€Terasolunaãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å®Ÿæ–½æ™‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®STS4.3ã‚’åˆ©ç”¨ã™ã‚‹ã€‚</p>
</ul>
<h2 id="createproj"><a class="anchor" href="#createproj"></a>2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ</h2>
<p>
    <a href="https://start.spring.io/">Spring Initializr</a>
    ã‚’åˆ©ç”¨ã—ã¦ã€Spring Bootã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚æ‰‹é †ã‚’ä»¥ä¸‹ã«ç¤ºã™ã€‚
    <ul class="sectlevel1">
        <ol>
            <li type=I>
                <a href="https://start.spring.io/">Spring Initializr</a>
                ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚
                </a>
            </li>
            <li type=I>
                Spring Initializrã®è¨­å®šç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚ä»¥ä¸‹ã®è¨­å®šå€¤ã‚’å…¥åŠ›ã™ã‚‹ã€‚
                <ul>
                <p>
                    <table border=1  width=1000>
                        <tr>
                            <th colspan=2>é …ç›®å</th>
                            <th>è¨­å®šå€¤</th>
                            <th>å‚™è€ƒ</th>
                        </tr>
                        <tr>
                            <td colspan=2>Project</td>
                            <td>Maven Project</td>
                            <td>Mavenã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹è¨­å®šã¨ã™ã‚‹ã€‚</td>
                        </tr>
                        <tr>
                            <td colspan=2>Language</td>
                            <td>Java</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan=2>Spring Boot</td>
                            <td>2.5.6</td>
                            <td></td>
                        </tr>
                        <tr><td rowspan="8">Project Metadata</td></tr>
                        <tr>
                            <td>Group</td>
                            <td>com.example</td>
                            <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æŒ‡å®šã™ã‚‹ã€‚</td>
                        </tr>
                        <tr>
                            <td>Artifact</td>
                            <td>tutorial</td>
                            <td>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æˆæœç‰©ã®åå‰  </td>
                        </tr>
                        <tr>
                            <td>Name</td>
                            <td>tutorial</td>
                            <td>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¡¨ç¤ºåã€‚ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã¨ããªã©ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</td>
                        </tr>
                        <tr>
                            <td>Desription</td>
                            <td>tutorial Project</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Package name</td>
                            <td>com.exaple.tutorial</td>
                            <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å</td>
                        </tr>
                        <tr>
                            <td>Packaging</td>
                            <td>Jar</td>
                            <td>WARã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹ã‹ã€Jarã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹ã‹ã‚’é¸æŠã€‚Jarã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹ã¨å®Ÿè¡Œç’°å¢ƒã‚’çµ„ã¿è¾¼ã‚ã‚‹ã€‚</td>
                        </tr>
                        <tr>
                            <td>Java</td>
                            <td>8</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan=2 rowspan=5>
                                Dependancies
                                <br>
                                â€»ç”»é¢å³ä¸Šã®ADD DEPENDANCIES...ã‹ã‚‰è¿½åŠ 
                            </td>
                        </tr>
                        <tr>
                            <td>SpringWeb</td>
                            <td>Webã‚¢ãƒ—ãƒªã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</td>
                        </tr>
                        <tr>
                            <td>Lombok</td>
                            <td>é–‹ç™ºåŠ¹ç‡åŒ–ã®ãŸã‚ã®ã‚½ãƒ¼ã‚¹è‡ªå‹•ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª</td>
                        </tr>
                        <tr>
                            <td>H2 Database</td>
                            <td>ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</td>
                        </tr>
                        <tr>
                            <td>MyBatis Framework</td>
                            <td>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</td>
                        </tr>
                    </table>
                </p>
                </ul>
                <li type=I>
                ç”»é¢ä¸‹éƒ¨ã® GENERATE + â ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚tutorial.zipãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã€‚
                <li type=I>
                ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸzipãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ã§å±•é–‹ã™ã‚‹ã€‚
                <li type=I>
                å±•é–‹ãƒ•ã‚©ãƒ«ãƒ€ä¸Šã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€å‹•ä½œç¢ºèªã‚’è¡Œã†ã€‚
                <pre><code>mvn spring-boot:run</code></pre>
                ã€è¡¨ç¤ºä¾‹ã€‘
                <pre><code>
                    .
                    .
                    ...pom.xmlã«è¨˜è¼‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
                    .
                    .
                    [INFO] Attaching agents: []

                    .   ____          _            __ _ _
                   /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
                  ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
                   \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
                    '  |____| .__|_| |_|_| |_\__, | / / / /
                   =========|_|==============|___/=/_/_/_/
                   :: Spring Boot ::                (v2.5.6)
                  
                  2021-11-10 01:47:34.489  INFO 11544 --- [           main] c.example.turorial.TurorialApplication   : Starting TurorialApplication using Java 14.0.2 on DESKTOP-VU8QFTR with PID 11544 (C:\study\spring\springbootâ–’`â–’â–’â–’[â–’gâ–’â–’â–’Aâ–’â–’\â–’Aâ–’vâ–’â–’â–’ì¬\turorial\target\classes started by user in C:\study\spring\springbootâ–’`â–’â–’â–’[â–’gâ–’â–’â–’Aâ–’â–’\â–’Aâ–’vâ–’â–’â–’ì¬\turorial)
                  2021-11-10 01:47:34.505  INFO 11544 --- [           main] c.example.turorial.TurorialApplication   : No active profile set, falling back to default profiles: default
                  2021-11-10 01:47:35.237  WARN 11544 --- [           main] o.m.s.mapper.ClassPathMapperScanner      : No MyBatis mapper was found in '[com.example.turorial]' package. Please check your configuration.
                  2021-11-10 01:47:35.725  INFO 11544 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
                  2021-11-10 01:47:35.741  INFO 11544 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
                  2021-11-10 01:47:35.741  INFO 11544 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.54]
                  2021-11-10 01:47:35.841  INFO 11544 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
                  2021-11-10 01:47:35.841  INFO 11544 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1267 ms
                  2021-11-10 01:47:36.382  INFO 11544 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
                  2021-11-10 01:47:36.398  INFO 11544 --- [           main] c.example.turorial.TurorialApplication   : Started TurorialApplication in 2.452 seconds (JVM running for 2.899)
                    
                </code></pre>
            </li>
        </ol>
        </ul>
</p>
<h2 id="commitproj"><a class="anchor" href="#commitproj"></a>3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒŸãƒƒãƒˆ</h2>
ä»¥ä¸‹æ‰‹é †ã§ä½œæˆã—ãŸSprin Bootãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã«ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ã€‚
<ul>
    <ol>
        <li>GitHubä¸Šã§æ–°è¦ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚</li>
        <li>
            ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã€GitHubã«pushã™ã‚‹ã€‚
            <pre><code>
                git init
                echo "# Study Spring Boot" >> README.md
                git add .
                git commit -m "first commit"
                git remote add origin git@github.com:yushin1402/spring-boot.git
                git push -u origin master
            </code></pre>
        </li>
    </ol>
</ul>
<h2 id="importproj"><a class="anchor" href="#importproj"></a>4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h2>
ä»¥ä¸‹æ‰‹é †ã§ä½œæˆã—ãŸSprin Bootãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’STSã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚
<ul>
    <ol>
        <li>ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«æŒ‡å®šã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã™ã‚‹ã€‚</li>
        <li>ä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«æŒ‡å®šã—ã¦STSã‚’èµ·å‹•ã™ã‚‹ã€‚</li>
        <li>ãƒ•ã‚¡ã‚¤ãƒ«â†’ã‚¤ãƒ³ãƒãƒ¼ãƒˆâ†’Maven>æ—¢å­˜Mavenãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸ã‚“ã§ã€æ¬¡ã¸ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚</li>
        <li>ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠã—ã€å®Œäº†ã™ã‚‹ã€‚(pom.xmlãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€)</li>
        <li>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ã«tutorialãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚</li>
        <li>
            ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å³ã‚¯ãƒªãƒƒã‚¯â†’å®Ÿè¡Œâ†’SpringBootã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¦å‹•ä½œç¢ºèªã‚’è¡Œã†ã€‚
            <br>
            ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒSTSã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã•ã‚Œã€æ­£å¸¸ã«èµ·å‹•ã—ãŸã“ã¨ã‚’ç¢ºèªå‡ºæ¥ã‚Œã°OKã€‚
            <pre><code>
                 .   ____          _            __ _ _
                 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
                ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
                 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
                  '  |____| .__|_| |_|_| |_\__, | / / / /
                 =========|_|==============|___/=/_/_/_/
                [32m :: Spring Boot :: [39m              [2m (v2.5.6)[0;39m

                [2m2021-11-10 02:48:52.487[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mc.example.turorial.TurorialApplication  [0;39m [2m:[0;39m Starting TurorialApplication using Java 16.0.2 on DESKTOP-VU8QFTR with PID 12080 (C:\study\spring\springbootãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«\ã‚¢ãƒ—ãƒªä½œæˆ\turorial\target\classes started by user in C:\study\spring\springbootãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«\ã‚¢ãƒ—ãƒªä½œæˆ\turorial)
                [2m2021-11-10 02:48:52.493[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mc.example.turorial.TurorialApplication  [0;39m [2m:[0;39m No active profile set, falling back to default profiles: default
                [2m2021-11-10 02:48:53.254[0;39m [33m WARN[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.m.s.mapper.ClassPathMapperScanner     [0;39m [2m:[0;39m No MyBatis mapper was found in '[com.example.turorial]' package. Please check your configuration.
                [2m2021-11-10 02:48:53.681[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.s.b.w.embedded.tomcat.TomcatWebServer [0;39m [2m:[0;39m Tomcat initialized with port(s): 8080 (http)
                [2m2021-11-10 02:48:53.691[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.apache.catalina.core.StandardService  [0;39m [2m:[0;39m Starting service [Tomcat]
                [2m2021-11-10 02:48:53.692[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36morg.apache.catalina.core.StandardEngine [0;39m [2m:[0;39m Starting Servlet engine: [Apache Tomcat/9.0.54]
                [2m2021-11-10 02:48:53.779[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.a.c.c.C.[Tomcat].[localhost].[/]      [0;39m [2m:[0;39m Initializing Spring embedded WebApplicationContext
                [2m2021-11-10 02:48:53.779[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mw.s.c.ServletWebServerApplicationContext[0;39m [2m:[0;39m Root WebApplicationContext: initialization completed in 1226 ms
                [2m2021-11-10 02:48:54.413[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.s.b.w.embedded.tomcat.TomcatWebServer [0;39m [2m:[0;39m Tomcat started on port(s): 8080 (http) with context path ''
                [2m2021-11-10 02:48:54.424[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mc.example.turorial.TurorialApplication  [0;39m [2m:[0;39m Started TurorialApplication in 2.392 seconds (JVM running for 3.347)
            </code></pre>
            
            â€»<code>maven spring-boot:run</code>ã§ãƒ†ã‚¹ãƒˆèµ·å‹•ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåœæ­¢å‡ºæ¥ã¦ã„ãªã‹ã£ãŸãŸã‚ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã¨ãªã£ãŸã€‚
            <pre><code>
                ***************************
                APPLICATION FAILED TO START
                ***************************

                Description:

                Web server failed to start. Port 8080 was already in use.
            </code></pre>
            <code>netstat</code>ã‚³ãƒãƒ³ãƒ‰ã§8080ãƒãƒ¼ãƒˆã‚’Listenã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç‰¹å®šã—ã€ã‚¿ã‚¹ã‚¯ãƒãƒãƒ¼ã‚¸ãƒ£ã‹ã‚‰çµ‚äº†ã™ã‚‹ã“ã¨ã§å¯¾å¿œã—ãŸã€‚
        </li> 
               
    </ol>
</ul>
<h2 id="createapi"><a class="anchor" href="#createapi"></a>5. REST APIã®ä½œæˆ</h2>
<ul>
    <h2 id="initset"><a class="anchor" href="#initset"></a>5.1 åˆæœŸè¨­å®š</h2>
    <ul>
         <h3 id="configurepom"><a class="anchor" href="#configurepom"></a>5.1.1 pom.xmlã®è¨­å®š</h2>
        ä»¥ä¸‹ã®å®šç¾©ã‚’pom.xmlã«è¨­å®šã™ã‚‹ã€‚
        <pre><code>
            &lt;dependency&gt;
                &lt;groupId&gt;com.github.dozermapper&lt;/groupId&gt;
                &lt;artifactId&gt;dozer-spring-boot-starter&lt;/artifactId&gt;
                &lt;version&gt;6.5.0&lt;/version&gt;
            &lt;/dependency&gt;
            â†‘â†‘  ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚
                ã‚³ãƒ”ãƒ¼å…ƒã‹ã‚‰ã‚³ãƒ”ãƒ¼å…ˆã«åŒã˜å±æ€§å€¤ãŒã‚ã‚‹é™ã‚Šã€å€¤ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚ã“ã®éš›ã€å‹ãŒç•°ãªã‚‹å ´åˆã¯è‡ªå‹•å¤‰æ›ã—ã¦ãã‚Œã‚‹ã€‚
                é€šå¸¸ã€ã“ã®ã‚ˆã†ãªå‡¦ç†ã‚’è¡Œã†ã«ã¯getterãƒ¡ã‚½ãƒƒãƒ‰ã¨setterãƒ¡ã‚½ãƒƒãƒ‰ã®å‘¼ã³å‡ºã—ãŒå¿…è¦ã ãŒã€Dozerã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§
                ã‚³ãƒ¼ãƒ‰ã‚’ç°¡ç•¥åŒ–ã§ãã‚‹ã€‚  ã€€ã€€
            &lt;dependency&gt;
                &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
                &lt;artifactId&gt;mybatis-spring-boot-starter-test&lt;/artifactId&gt;
                &lt;version&gt;2.1.0&lt;/version&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
            â†‘â†‘ MyBatisã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª   
        </code></pre>
    </ul>
    <ul>
        <h2 id="configureyaml"><a class="anchor" href="#configureyaml"></a>5.1.2 application.ymlã®è¨­å®š</h2>  
            application.yamlã§Spring Bootèµ·å‹•æ™‚ã«ç”Ÿæˆã•ã‚Œã‚‹Beanã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šã‚’è¡Œã†ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚
            ãƒ­ã‚°å‡ºåŠ›ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šã€ãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šãªã©ã‚’å¤‰æ›´å‡ºæ¥ã‚‹ã€‚
            <br>
            å‚è€ƒï¼š<a href="https://spring.pleiades.io/spring-boot/docs/current/reference/html/application-properties.html">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®šä¸€è¦§</a>
            <br>
            ä»Šå›ã¯ä»¥ä¸‹ã®é€šã‚Šã€Mybatisã®SnakeCaseã§å®šç¾©ã•ã‚ŒãŸã‚«ãƒ©ãƒ åã‚’CamelCaseã«å¤‰æ›(ä¾‹ï¼šcamel-caseâ†’camelCase)ã—ã€Formã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚«ãƒ©ãƒ åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹è¨­å®šã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã€‚
            (yamlå½¢å¼ã§è¨˜è¿°ã™ã‚‹ãŸã‚ã€src/main/resources/ä¸‹ã«ã‚ã‚‹application.propertiesã‚’application.ymlã«ãƒªãƒãƒ¼ãƒ ã—ãŸä¸Šã§è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã€‚)
            <pre><code>
                mybatis:
                  configuration:
                    mapUnderscoreToCamelCase: true
            </code></pre>
    </ul>
    <h2 id="createpkg"><a class="anchor" href="#createpkg"></a>5.2 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½œæˆ</h2>
        ä»¥ä¸‹ã®æ§‹æˆã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚
        <pre><code>
            â”œâ”€src
            â”‚  â”œâ”€main
            â”‚  â”‚  â”œâ”€java
            â”‚  â”‚  â”‚  â””â”€com
            â”‚  â”‚  â”‚      â””â”€example
            â”‚  â”‚  â”‚          â””â”€tutorial              
            â”‚  â”‚  â”‚              â”œâ”€common             
            â”‚  â”‚  â”‚              â”‚  â””â”€exception      â†æ–°è¦ä½œæˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
            â”‚  â”‚  â”‚              â””â”€todo               â†æ–°è¦ä½œæˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
            â”‚  â””â”€test
            â”‚      â””â”€java
            â”‚          â””â”€com
            â”‚              â””â”€example
            â”‚                  â””â”€tutorial               
            â”‚                      â””â”€todo              â†æ–°è¦ä½œæˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
            
        </code></pre>
        ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯STSã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ä¸Šã§tutrialãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å³ã‚¯ãƒªãƒƒã‚¯â†’æ–°è¦â†’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨é¸æŠã—ã€
        ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆå ´æ‰€ã®ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’æŒ‡å®šã—ã¦ä½œæˆã™ã‚‹ã€‚
        ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ã€ãƒ•ã‚©ãƒ«ãƒ€éšå±¤ã«åˆã‚ã›ã¦æŒ‡å®šã™ã‚‹ã€‚(exceptionãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å ´åˆã¯ã€Œcom.example.tutorial.common.exeptionã€)

        <h2 id="createsrcfld"><a class="anchor" href="#createsrcfld"></a>5.3 ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ</h2>
            ãƒ†ã‚¹ãƒˆç”¨ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã™ã‚‹ã€‚(ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:tutorialã€ãƒ•ã‚©ãƒ«ãƒ€å:src/test/resources)
            <br>
            ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã¨ã¯Javaã®ã‚³ãƒ¼ãƒ‰ã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã€‚Javaã®ä¸–ç•Œã§ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ˜ã«åŒºåˆ¥ã™ã‚‹ã€‚
            <br>
            <ul>
            <li>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</li>
            ã‚¯ãƒ©ã‚¹ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸã‚‚ã®ã€‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ§‹æˆã«å¾“ã£ã¦ã€å®Ÿè¡Œä½“ãŒç”Ÿæˆã•ã‚Œã¦ã„ãç†è§£ã€‚
            <li>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</li>
            ã‚½ãƒ¼ã‚¹ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸã‚‚ã®ã€‚
            <br>
        </ul>
            ãªãŠã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã‚‚å®Ÿæ…‹ã¯ãŸã ã®ãƒ•ã‚©ãƒ«ãƒ€ã ãŒã€STSã‚„mavenã¯.classpathã®è¨˜è¿°å†…å®¹ã‚’å‚ç…§ã—ã¦åŒºåˆ¥ã—ã¦ã„ã‚‹ã€‚
            <pre><code>
                &lt;classpathentry kind="src" output="target/classes" path="src/main/java"&gt;
                    &lt;attributes&gt;
                        &lt;attribute name="optional" value="true"/&gt;
                        &lt;attribute name="maven.pomderived" value="true"/&gt;
                    &lt;/attributes&gt;
                &lt;/classpathentry&gt;
            </code></pre> 
            
            ä»Šå›ä½œæˆã—ãŸã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã¯ãƒ†ã‚¹ãƒˆç”¨ã‚½ãƒ¼ã‚¹ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚‹ã€‚Mavenãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã•ã›ã‚‹ãŸã‚ã€
            ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ†ã‚¹ãƒˆç”¨ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã¨ã—ã¦Mavenã«èªè­˜ã•ã›ã‚‹ã€‚æ‰‹é †ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
            <ol>
                <li>STSã®ç”»é¢ä¸Šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ã‚’å³ã‚¯ãƒªãƒƒã‚¯</li>
                <li>Maven(M)ã‚’é¸æŠ</li>
                <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°ã‚’é¸æŠ</li>
                <li>src/test/resourcesã«ã‚¢ã‚¤ã‚³ãƒ³ãŒè¿½åŠ ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª</li>
            </ol>
            <h2 id="createtodo"><a class="anchor" href="#createtodo"></a>5.4 Todoã‚¯ãƒ©ã‚¹ã®ä½œæˆ</h2>
            ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ãŸæ–¹æ³•ã¨åŒã˜è¦é ˜ã§Todoã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
             <table width=500>
                 <tr>
                     <th>é …ç›®å</th>
                     <th>è¨­å®šå€¤</th>
                 </tr>
                 <tr>
                     <td>Source Folder</td>
                     <td>turorial/src/main/java</td>
                 </tr>
                 <tr>
                    <td>Package</td>
                    <td>com.example.tutorial.todo</td>
                </tr>
                <tr>
                    <td>Name</td>
                    <td>Todo</td>
                </tr>
                <tr>
                    <td>interfaces</td>
                    <td>java.io.Serializable</td>
                </tr>
             </table>
             ä½œæˆã—ãŸTodo.javaã¯ã€ï½ã‚’ç”Ÿæˆã™ã‚‹ã‚¯ãƒ©ã‚¹ã¨ãªã‚‹ã€‚ã“ã®ãŸã‚ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æƒ…å ±ã‚’å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨
             ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹Setterã¨Getterã®å®Ÿè£…ãŒå¿…è¦ã¨ãªã‚‹ã€‚ã¾ãŸã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®åˆæœŸåŒ–ã‚’è¡Œã†ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å®Ÿè£…ã‚‚å¿…è¦ã§ã‚ã‚‹ã€‚
             <br>
             ã“ã‚Œã‚‰ã®å‡¦ç†ã¯Lombokæä¾›ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°ã™ã‚‹ã ã‘ã§å®Ÿè£…å¯èƒ½ã€‚ä»¥ä¸‹ãŒã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨ãªã‚‹ã€‚
             <pre><code>
                package com.example.tutorial.todo;

                import java.io.Serializable;
                import java.time.LocalDateTime;
                import lombok.AllArgsConstructor;
                import lombok.Getter;
                import lombok.NoArgsConstructor;
                import lombok.Setter;
                
                @Getter //ä¸‹è¨˜ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹Getterãƒ¡ã‚½ãƒƒãƒ‰ã‚’SpringBootèµ·å‹•æ™‚ã«å®Ÿè£…ã—ã¦ãã‚Œã‚‹ã€‚
                @Setterã€€//ä¸‹è¨˜ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹Settersãƒ¡ã‚½ãƒƒãƒ‰ã‚’SpringBootèµ·å‹•æ™‚ã«å®Ÿè£…ã—ã¦ãã‚Œã‚‹ã€‚
                @AllArgsConstructorã€€//ä¸‹è¨˜ã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«åˆæœŸå€¤ã‚’è¨­å®šã™ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’SpringBootèµ·å‹•æ™‚ã«å®Ÿè£…ã—ã¦ãã‚Œã‚‹ã€‚
                @NoArgsConstructorã€€//å¼•æ•°ãªã—ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿)ã‚’å®Ÿè£…ã—ã¦ãã‚Œã‚‹ã€‚
                
                public class Todo implements Serializable {
                    private static final long serialVersionUID = 1L;ã€€//ã“ã®å¾Œå®Ÿè£…ã™ã‚‹REST APIã§åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å€¤
                 
                    private Long todoId; //ã“ã®å¾Œå®Ÿè£…ã™ã‚‹REST APIã§åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å€¤
                
                    private String todoTitle;ã€€//ã“ã®å¾Œå®Ÿè£…ã™ã‚‹REST APIã§åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å€¤
                
                    private boolean finished;ã€€//ã“ã®å¾Œå®Ÿè£…ã™ã‚‹REST APIã§åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å€¤
                
                    private LocalDateTime createdAt;ã€€//ã“ã®å¾Œå®Ÿè£…ã™ã‚‹REST APIã§åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å€¤
                }
               </code></pre>
             <h2 id="createtodoresrc"><a class="anchor" href="#createtodoresrc"></a>5.5 TodoResourceã‚¯ãƒ©ã‚¹ã®ä½œæˆ</h2>
             ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã®å…¥å‡ºåŠ›ã«ä½¿ç”¨ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦ã€TodoResourceã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
             ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿è¡¨ç¾å½¢å¼ã«ã¯JSONã‚’åˆ©ç”¨ã™ã‚‹ã€‚TodoReourceã‚¯ãƒ©ã‚¹ã¯ã€JSONã‚’è§£æã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒ–ã™ã‚‹ã€‚
             <table width=500>
                <tr>
                    <th>é …ç›®å</th>
                    <th>è¨­å®šå€¤</th>
                </tr>
                <tr>
                    <td>Source Folder</td>
                    <td>turorial/src/main/java</td>
                </tr>
                <tr>
                   <td>Package</td>
                   <td>com.example.tutorial.todo</td>
               </tr>
               <tr>
                   <td>Name</td>
                   <td>TodoResource</td>
               </tr>
               <tr>
                   <td>interfaces</td>
                   <td>java.io.Serializable</td>
               </tr>
            </table>
            ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã™ã‚‹ã€‚ãªãŠã€æœ€æ–°ã®mavenã§ã¯ã€javax.validationãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€pom.xmlã«ä¾å­˜é–¢ä¿‚ã®å®šç¾©ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
            <pre><code>
                package com.example.tutorial.todo;

                import java.io.Serializable;
                import java.time.LocalDateTime;
                import javax.validation.constraints.NotEmpty;
                import javax.validation.constraints.Size;
                import com.fasterxml.jackson.annotation.JsonFormat;
                import lombok.AllArgsConstructor;
                import lombok.Getter;
                import lombok.NoArgsConstructor;
                import lombok.Setter;
                
                @Getter
                @Setter
                @AllArgsConstructor
                @NoArgsConstructor
                public class TodoResource implements Serializable {
                
                    private static final long serialVersionUID = 1L;
                
                    private Long todoId;
                
                    @NotEmpty  // validationãƒã‚§ãƒƒã‚¯ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ã“ã®ã‚¯ãƒ©ã‚¹ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®å…¥åŠ›ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ã‚¨ãƒ©ãƒ¼åˆ¤å®šã™ã‚‹ã€‚
                    @Size(max = 30)ã€€// validationãƒã‚§ãƒƒã‚¯ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ã“ã®ã‚¯ãƒ©ã‚¹ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®å…¥åŠ›ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ã‚¨ãƒ©ãƒ¼åˆ¤å®šã™ã‚‹ã€‚
                    private String todoTitle;
                
                    private boolean finished;
                
                    @JsonFormat(pattern = "uuuu/MM/dd HH:mm:ss")ã€€// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æŒ‡å®šã€‚
                    private LocalDateTime createdAt;
                
                }                
            </code></pre>
            pom.xmlã«è¿½åŠ ã—ãŸã‚³ãƒ¼ãƒ‰
            <pre><code>
                &lt;dependency&gt;
                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                    &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
              &lt;/dependency&gt;
            </code></pre>   
            <h2 id="createrepo"><a class="anchor" href="#createrepo"></a>5.6 Repositoryã‚¯ãƒ©ã‚¹ã®ä½œæˆ</h2>
            MyBaticã‚’åˆ©ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ãŸã‚ã®å®Ÿè£…ã¨è¨­å®šã‚’è¡Œã†ã€‚
            <ul>
                <h2 id="createtable"><a class="anchor" href="#createtable"></a>5.6.1 ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ</h2>
                H2ã‚’åˆ©ç”¨ã™ã‚‹ã€‚H2ã«ã¤ã„ã¦ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®šæ¸ˆã¿ã®ãŸã‚ã€ãã®ã¾ã¾åˆ©ç”¨å‡ºæ¥ã‚‹ã€‚
                ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹(Postgresãªã©)ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€Œapplication.yamlã€ã§æ¥ç¶šè¨­å®šã‚’è¡Œã†ã€‚
                <br>
                todoã‚¿ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚
                <table width=500>
                    <tr>
                        <th>é …ç›®å</th>
                        <th>è¨­å®šå€¤</th>
                    </tr>
                    <tr>
                        <td>è¦ªãƒ•ã‚©ãƒ«ãƒ€</td>
                        <td>turorial/src/main/resources</td>
                    </tr>
                    <tr>
                       <td>ãƒ•ã‚¡ã‚¤ãƒ«å</td>
                       <td>schema.sql</td>
                   </tr>
                </table>
                ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®SQLã‚’è¨˜è¿°ã™ã‚‹ã€‚
                <pre><code>
                    CREATE TABLE IF NOT EXISTS todo (
                        todo_id BIGINT IDENTITY PRIMARY KEY,
                        todo_title VARCHAR(30),
                        finished BOOLEAN,
                        created_at TIMESTAMP
                      );                    
                </code></pre>
                <h2 id="createtodorepo"><a class="anchor" href="#createtodorepo"></a>5.6.2 TodoRepositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½œæˆ</h2>
                MyBaticã‚’åˆ©ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
                <table width=500>
                    <tr>
                        <th>é …ç›®å</th>
                        <th>è¨­å®šå€¤</th>
                    </tr>
                    <tr>
                        <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                        <td>turorial/src/main/java</td>
                    </tr>
                    <tr>
                       <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                       <td>com.example.tutorial.todo</td>
                   </tr>
                   <tr>
                       <td>åå‰</td>
                        <td>TodoRepository</td>
                    </tr>
                </table>
                ä½œæˆã—ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨˜è¿°ã™ã‚‹ã€‚
                <pre><code>
                    package com.example.tutorial.todo;

                    import java.util.Collection;
                    import java.util.Optional;
                    import org.apache.ibatis.annotations.Delete;
                    import org.apache.ibatis.annotations.Insert;
                    import org.apache.ibatis.annotations.Mapper;
                    import org.apache.ibatis.annotations.Options;
                    import org.apache.ibatis.annotations.Select;
                    import org.apache.ibatis.annotations.Update;
                    
                    @Mapper // (1)
                    public interface TodoRepository {
                    
                        @Select("SELECT todo_id, todo_title, finished, created_at FROM todo WHERE todo_id = #{todoId}") // (2)
                        Optional<Todo> findById(Long todoId);
                    
                        @Select("SELECT todo_id, todo_title, finished, created_at FROM todo")
                        Collection<Todo> findAll();
                    
                        @Insert("INSERT INTO todo(todo_title, finished, created_at) VALUES(#{todoTitle}, #{finished}, #{createdAt})")
                        @Options(useGeneratedKeys = true, keyProperty = "todoId")
                        void create(Todo todo);
                    
                        @Update("UPDATE todo SET finished = true WHERE todo_id = #{todoId}")
                        long updateById(Long todoId);
                    
                        @Delete("DELETE FROM todo WHERE todo_id = #{todoId}")
                        long deleteById(Long todoId);
                    
                        @Select("SELECT COUNT(*) FROM todo WHERE finished = #{finished}")
                        long countByFinished(boolean finished);
                    }
                </code></pre>
                ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã¯MyBaticã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚„å‹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã€‚
                ä»¥ä¸‹ã«å„ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦è¨˜è¼‰ã™ã‚‹ã€‚
                <table width=500>
                    <tr>
                        <th>é …ç›®å</th>
                        <th>æ„å‘³</th>
                    </tr>
                    <tr>
                        <td>@Mapper</td>
                        <td>MyBatisã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹éš›ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«@Mapperã‚’è¨˜è¿°ã™ã‚‹ã€‚MyBaticã¯Javaã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨xmlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§SQLã‚’xmlãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ãŸã‚ã€@Mapperã‚’åˆ©ç”¨ã™ã‚‹ãŒã€ä»Šå›ã¯ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ã›ãšã€SQLã‚’Javaã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ç›´æ¥æ›¸ãè¾¼ã‚€ã€‚</td>
                    </tr>
                    <tr>
                       <td>@Select</td>
                       <td>Selectæ–‡ã‚’è¨˜è¿°ã™ã‚‹ã€‚Whereå¥ã®å¯¾è±¡ã«#{todoId}ã¨è¨˜è¿°ãŒã‚ã‚‹ãŒã€ã“ã‚Œã¯ã€ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒä»˜ä¸ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã§è¿”å´ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã€‚ä»Šå›ã¯ä½œæˆæ¸ˆã¿ã®Todo.javaã§å®šç¾©ã—ãŸTodoã‚¯ãƒ©ã‚¹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã€‚ãªãŠã€MyBaticã®ã‚«ãƒ©ãƒ åã¯ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹ãŒã€application.yamlã§CamelCaseã¸ã®å¤‰æ›å®šç¾©ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚</td>
                   </tr>
                   <tr>
                    <td>@Options</td>
                    <td>ãƒ‡ãƒ¼ã‚¿æ“ä½œæ™‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã€‚useGeneratedKeysã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å´ã§è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ¼ã‚’è‡ªå‹•å–å¾—ã™ã‚‹è¨­å®šã¨ã—ã¦ã„ã‚‹ã€‚å–å¾—ã•ã‚ŒãŸã‚­ãƒ¼ã¯keyPropertyã«è¨­å®šã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã§å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚</td>
                </tr>
                </table>
                <h2 id="testrepo"><a class="anchor" href="#testrepo"></a>5.6.3 Repositoryã®å˜ä½“ãƒ†ã‚¹ãƒˆ</h2>
                SpringBootæä¾›ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã€‚
                <ul>
                    <h2 id="createinitdata"><a class="anchor" href="#createinitdata"></a>5.6.3.1 åˆæœŸãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ</h2>
                    tutorial/src/test/resourcesé…ä¸‹ã«data.sql(åˆæœŸãƒ‡ãƒ¼ã‚¿ä½œæˆSQLãƒ•ã‚¡ã‚¤ãƒ«)ã‚’ä½œæˆã™ã‚‹ã€‚
                    åˆæœŸãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®SQLæ–‡ã§æŠ•å…¥ã™ã‚‹ã€‚
                    <pre><code>
                        INSERT INTO todo (todo_title, finished, created_at ) VALUES ('sample todo 1', false, '2019-09-19 01:01:01' )
                        INSERT INTO todo (todo_title, finished, created_at ) VALUES ('sample todo 2', true, '2019-09-19 02:02:02' )
                        INSERT INTO todo (todo_title, finished, created_at ) VALUES ('sample todo 3', false, '2019-09-19 03:03:03' )                        
                    </code></pre>
                    <h2 id="createtest"><a class="anchor" href="#createtest"></a>5.6.3.2 SpringTestã®æ¨™æº–æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ãŸãƒ†ã‚¹ãƒˆã®å®Ÿè£…</h2>                    
                    @MyBaticTestã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ãŸRepositoryã®ã‚¹ãƒ©ã‚¤ã‚¹ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ã€TodoRepositoryTestã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
                    <br>
                    (ã‚¹ãƒ©ã‚¤ã‚¹ãƒ†ã‚¹ãƒˆã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å‹•ä½œã«å¿…è¦ãªæœ€å°é™ã®Beanã®ã¿ã‚’DIã—ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹æŠ€æ³•ã€ã€ãŸã¶ã‚“ã€ã€ã€)
                    <br>
                    <table width=500>
                        <tr>
                            <th>é …ç›®å</th>
                            <th>è¨­å®šå€¤</th>
                        </tr>
                        <tr>
                            <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                            <td>turorial/src/test/java</td>
                        </tr>
                        <tr>
                           <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                           <td>com.example.tutorial.todo</td>
                       </tr>
                       <tr>
                           <td>åå‰</td>
                            <td>TodoRepositoryTest</td>
                        </tr>
                    </table>
                    <br>
                    ä¸Šè¨˜ã§ä½œæˆã—ãŸã‚½ãƒ¼ã‚¹ã«ä»¥ä¸‹ã‚’è¨˜è¿°
                    <pre><code>
                        package com.example.tutorial.todo;

                        import static org.assertj.core.api.Assertions.assertThat;
                        import static org.assertj.core.api.Assertions.tuple;
                        import java.time.LocalDateTime;
                        import java.time.format.DateTimeFormatter;
                        import java.util.Collection;
                        import org.junit.jupiter.api.DisplayName;
                        import org.junit.jupiter.api.Test;
                        import org.mybatis.spring.boot.test.autoconfigure.MybatisTest;
                        import org.springframework.beans.factory.annotation.Autowired;
                        import org.springframework.jdbc.core.BeanPropertyRowMapper;
                        import org.springframework.jdbc.core.RowMapper;
                        import org.springframework.jdbc.core.namedparam.EmptySqlParameterSource;
                        import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
                        import org.springframework.jdbc.core.namedparam.NamedParameterJdbcOperations;
                        import org.springframework.jdbc.core.namedparam.SqlParameterSource;
                        
                        @MybatisTest // (1)
                        public class TodoRepositoryTest {
                        
                            private static final DateTimeFormatter DATETIME_FORMAT = DateTimeFormatter.ofPattern("uuuu/MM/dd HH:mm:ss");
                        
                            @Autowired
                            private TodoRepository todoRepository; // (2)
                        
                            @Autowired
                            NamedParameterJdbcOperations jdbcOperations; // (3)
                        
                            @Test
                            @DisplayName("å…¨TodoãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Repository)")
                            void testFindAll() {
                                // run
                                Collection<Todo> actualTodos = todoRepository.findAll();
                        
                                // check
                                assertThat(actualTodos)
                                    .extracting(Todo::getTodoId, Todo::getTodoTitle, Todo::isFinished, Todo::getCreatedAt)
                                    .contains(tuple(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT)),
                                            tuple(2L, "sample todo 2", true, LocalDateTime.parse("2019/09/19 02:02:02", DATETIME_FORMAT)),
                                            tuple(3L, "sample todo 3", false, LocalDateTime.parse("2019/09/19 03:03:03", DATETIME_FORMAT)));
                            }
                        
                            @Test
                            @DisplayName("todoIdã«å¯¾å¿œã™ã‚‹TodoãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Repository)")
                            void testFindById() {
                                // run
                                Todo actualTodo = todoRepository.findById(1L).get();
                        
                                // check
                                assertThat(actualTodo)
                                    .extracting(Todo::getTodoId, Todo::getTodoTitle, Todo::isFinished, Todo::getCreatedAt)
                                    .contains(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
                            }
                        
                            @Test
                            @DisplayName("æ–°ãŸãªTodoãŒä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Repository)")
                            void testCreate() {
                                // setup
                                Todo actualTodo = new Todo(null, "sample todo 4", false, LocalDateTime.parse("2019/09/19 04:04:04", DATETIME_FORMAT));
                        
                                // run
                                todoRepository.create(actualTodo);
                        
                                // check
                                Todo todo = getLastTodo();
                                assertThat(actualTodo)
                                    .isEqualToIgnoringGivenFields(todo, "todoId")
                                    .hasNoNullFieldsOrProperties();
                            }
                        
                            @Test
                            @DisplayName("finishedã‚’falseã‹ã‚‰trueã«å¤‰æ›´ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Repository)")
                            void testUpdateById() {
                                // setup
                                Todo todo = getTodo(1L);
                        
                                // run
                                long count = todoRepository.updateById(1L);
                                Todo updated = getTodo(1L);
                        
                                // check
                                assertThat(count).isEqualTo(1L);
                                assertThat(updated)
                                    .isEqualToIgnoringGivenFields(todo, "finished")
                                    .hasFieldOrPropertyWithValue("finished", true);
                            }
                        
                            @Test
                            @DisplayName("todoId=1ãŒå‰Šé™¤ã§ãã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Repository)")
                            void testDeleteById() {
                                // run
                                long count = todoRepository.deleteById(1L);
                        
                                // check
                                assertThat(count).isEqualTo(1);
                            }
                        
                            @Test
                            @DisplayName("æœªå®Œäº† or å®Œäº†æ¸ˆã®Todoã®ä»¶æ•°ã‚’å–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Repository)")
                            void testCountByFinished() {
                                // run
                                long unfinishedCount = todoRepository.countByFinished(false);
                                long finishedCount = todoRepository.countByFinished(true);
                        
                                // check
                                assertThat(unfinishedCount).isEqualTo(2);
                                assertThat(finishedCount).isEqualTo(1);
                            }
                        
                            private Todo getLastTodo() {
                                String sql = "SELECT * FROM todo ORDER BY todo_id DESC LIMIT 1";
                                SqlParameterSource paramSource = new EmptySqlParameterSource();
                                RowMapper<Todo> rowMapper = new BeanPropertyRowMapper<>(Todo.class);
                                return jdbcOperations.queryForObject(sql, paramSource, rowMapper);
                            }
                        
                            private Todo getTodo(Long todoId) {
                                String sql = "SELECT * FROM todo WHERE todo_id=:todoId";
                                SqlParameterSource paramSource = new MapSqlParameterSource().addValue("todoId", todoId);
                                RowMapper<Todo> rowMapper = new BeanPropertyRowMapper<>(Todo.class);
                                return jdbcOperations.queryForObject(sql, paramSource, rowMapper);
                            }
                        
                        }
                    </code></pre>
                    ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆã‚’ä»¥ä¸‹ã«è¨˜è¿°
                    (ã‚¹ãƒ©ã‚¤ã‚¹ãƒ†ã‚¹ãƒˆã¯ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å‹•ä½œã«å¿…è¦ãªæœ€å°é™ã®Beanã®ã¿ã‚’DIã—ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹æŠ€æ³•ã€ã€ãŸã¶ã‚“ã€ã€ã€)
                    <br>
                    <table width=500>
                        <tr>
                            <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                            <th>ãƒ¡ãƒ¢</th>
                        </tr>
                        <tr>
                            <td>@MybatisTest</td>
                            <td>ã“ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã“ã¨ã§Beanç™»éŒ²ã•ã‚Œã‚‹å¯¾è±¡ãŒMyBatisãŒåˆ©ç”¨ã™ã‚‹ã‚‚ã®ã«é™å®šã•ã‚Œã‚‹ã€‚å†…éƒ¨çš„ã«ã¯@TransactionãŒä»˜ä¸ã•ã‚Œã¦ãŠã‚Šã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä¸€ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å‡¦ç†ã—ã€å®Œäº†å¾Œã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã€‚</td>
                        </tr>
                        <tr>
                           <td>@Autowired
                            ã€€ã€€<br>    
                               private TodoRepository todoRepository</td>
                           <td>todoRepositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’DIã—ã¦ã„ã‚‹ã€‚ä»¥é™ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¦ã„ã‚‹ã€‚</td>
                       </tr>
                       <tr>
                           <td>    @Autowired <br>
                            NamedParameterJdbcOperations jdbcOperations; </td>
                            <td>NamedParameterJDBCOperationsã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’DIã—ã¦ã„ã‚‹ã€‚MyBaticãŒç”¨æ„ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®é–“ã‚’ã¤ãªãã®ãŒJDBCã®ç†è§£ã€‚
                                <br>
                                ä»Šå›ã¯ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®queryForObjectã‚’åˆ©ç”¨ã—ã¦ã€sqlæ–‡ã€sqlæ–‡å®Ÿè¡Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€æˆ»ã‚Šã®å‹ã§å®Ÿè¡Œã—ã€ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã€‚
                                è©³ç´°ã¯<a href="https://spring.pleiades.io/spring-framework/docs/current/javadoc-api/org/springframework/jdbc/core/namedparam/NamedParameterJdbcOperations.html">ã“ã¡ã‚‰</a>
                                <br>
                                ç–‘å•ã€‚çµå±€SQLæ–‡ã®ç™ºè¡Œã‚’ç‹¬è‡ªã«å®šç¾©ã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ãŒã“ã‚Œã§ãƒ†ã‚¹ãƒˆã«ãªã£ã¦ã„ã‚‹ã®ï¼Ÿ
                                <br>
                                â†’ç‹¬è‡ªSQLã¯ç­”ãˆåˆã‚ã›ç”¨ã®çµæœã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã€‚ä¾‹ãˆã°66è¡Œç›®-69è¡Œç›®ã§todoRepository.create(actualTodo)ã‚’å‘¼ã³å‡ºã—ãŸå¾Œã«ç‹¬è‡ªSQLã§çµæœã‚’å–ã‚Šå‡ºã—ã¦NullãŒãªã„ã‹ã‚’è¦‹ã¦ã„ã‚‹ã€‚
                            </td>
                        </tr>
                        <tr>
                            <td>@Test</td>
                            <td>ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œå˜ä½</td>
                        </tr>
                        <tr>
                            <td>@DisplayName</td>
                            <td>ãƒ†ã‚¹ãƒˆã®è¡¨ç¤ºåã€‚ã“ã®ã‚ã¨JUnitã§å®Ÿè¡Œã—ãŸã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒåˆ†ã‹ã‚‹ã¯ãšã€‚</td>
                        </tr>
                    </table>
                    <h2 id="dotest"><a class="anchor" href="#dotest"></a>5.6.3.3 TodoRepositoryãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ</h2>
                    TodoRepositoryTest.javaã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€[Run AS]â†’[JUnit Test]ã‚’é¸æŠã—ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã€‚
                    <br>
                    å®Ÿè¡Œã™ã‚‹ã‚‚ä»¥ä¸‹ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã¨ã¨ã‚‚ã«ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒ1ä»¶ã‚‚å®Ÿè¡Œã•ã‚Œãšã€ç•°å¸¸çµ‚äº†ã—ãŸã€‚(6ä»¶ã®ä»¶æ•°ã¯è‰¯ã„è¾¼ã‚ã¦ã„ã‚‹ãŒã€‚ã€‚)
                    <pre><core>
                        22:18:00.349 [main] DEBUG org.springframework.test.context.BootstrapUtils - Instantiating CacheAwareContextLoaderDelegate from class [org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate]
                        22:18:00.369 [main] DEBUG org.springframework.test.context.BootstrapUtils - Instantiating BootstrapContext using constructor [public org.springframework.test.context.support.DefaultBootstrapContext(java.lang.Class,org.springframework.test.context.CacheAwareContextLoaderDelegate)]
                        22:18:00.443 [main] DEBUG org.springframework.test.context.BootstrapUtils - Instantiating TestContextBootstrapper for test class [com.example.tutorial.todo.TodoRepositoryTest] from class [org.mybatis.spring.boot.test.autoconfigure.MybatisTestContextBootstrapper]
                        22:18:00.467 [main] INFO org.mybatis.spring.boot.test.autoconfigure.MybatisTestContextBootstrapper - Neither @ContextConfiguration nor @ContextHierarchy found for test class [com.example.tutorial.todo.TodoRepositoryTest], using SpringBootContextLoader
                        22:18:00.474 [main] DEBUG org.springframework.test.context.support.AbstractContextLoader - Did not detect default resource location for test class [com.example.tutorial.todo.TodoRepositoryTest]: class path resource [com/example/tutorial/todo/TodoRepositoryTest-context.xml] does not exist
                        22:18:00.475 [main] DEBUG org.springframework.test.context.support.AbstractContextLoader - Did not detect default resource location for test class [com.example.tutorial.todo.TodoRepositoryTest]: class path resource [com/example/tutorial/todo/TodoRepositoryTestContext.groovy] does not exist
                        22:18:00.476 [main] INFO org.springframework.test.context.support.AbstractContextLoader - Could not detect default resource locations for test class [com.example.tutorial.todo.TodoRepositoryTest]: no resource found for suffixes {-context.xml, Context.groovy}.
                        22:18:00.478 [main] INFO org.springframework.test.context.support.AnnotationConfigContextLoaderUtils - Could not detect default configuration classes for test class [com.example.tutorial.todo.TodoRepositoryTest]: TodoRepositoryTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
                        22:18:00.607 [main] DEBUG org.springframework.test.context.support.ActiveProfilesUtils - Could not find an 'annotation declaring class' for annotation type [org.springframework.test.context.ActiveProfiles] and class [com.example.tutorial.todo.TodoRepositoryTest]                        
                    </core></pre>
                    ã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼ã£ã½ã„ã®ã§ã¨ã‚Šã‚ãˆãšã€Mavenã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ã¿ã‚‹ã€‚â†’è§£æ±ºã›ãšãƒ»
                    JUnitã‚¿ãƒ–ã«ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒã‚ã£ãŸã®ã§ç¢ºèªã—ã¦ã¿ã‚‹ã€‚
                    <pre><code>
                        java.lang.IllegalStateException: Unable to find a @SpringBootConfiguration, you need to use @ContextConfiguration or @SpringBootTest(classes=...) with your test
                        at org.springframework.util.Assert.state(Assert.java:76)
                        at org.springframework.boot.test.context.SpringBootTestContextBootstrapper.getOrFindConfigurationClasses(SpringBootTestContextBootstrapper.java:236)
                        at org.springframework.boot.test.context.SpringBootTestContextBootstrapper.processMergedContextConfiguration(SpringBootTestContextBootstrapper.java:152)
                        at org.springframework.test.context.support.AbstractTestContextBootstrapper.buildMergedContextConfiguration(AbstractTestContextBootstrapper.java:392)
                        at org.springframework.test.context.support.AbstractTestContextBootstrapper.buildDefaultMergedContextConfiguration(AbstractTestContextBootstrapper.java:309)
                        at org.springframework.test.context.support.AbstractTestContextBootstrapper.buildMergedContextConfiguration(AbstractTestContextBootstrapper.java:262)
                        at org.springframework.test.context.support.AbstractTestContextBootstrapper.buildTestContext(AbstractTestContextBootstrapper.java:107)
                        at org.springframework.boot.test.context.SpringBootTestContextBootstrapper.buildTestContext(SpringBootTestContextBootstrapper.java:102)
                        at org.springframework.test.context.TestContextManager.<init>(TestContextManager.java:137)
                        at org.springframework.test.context.TestContextManager.<init>(TestContextManager.java:122)
                        at org.junit.jupiter.engine.execution.ExtensionValuesStore.lambda$getOrComputeIfAbsent$4(ExtensionValuesStore.java:86)
                        at org.junit.jupiter.engine.execution.ExtensionValuesStore$MemoizingSupplier.computeValue(ExtensionValuesStore.java:223)
                        at org.junit.jupiter.engine.execution.ExtensionValuesStore$MemoizingSupplier.get(ExtensionValuesStore.java:211)
                        at org.junit.jupiter.engine.execution.ExtensionValuesStore$StoredValue.evaluate(ExtensionValuesStore.java:191)
                        at org.junit.jupiter.engine.execution.ExtensionValuesStore$StoredValue.access$100(ExtensionValuesStore.java:171)
                        at org.junit.jupiter.engine.execution.ExtensionValuesStore.getOrComputeIfAbsent(ExtensionValuesStore.java:89)
                        at org.junit.jupiter.engine.execution.ExtensionValuesStore.getOrComputeIfAbsent(ExtensionValuesStore.java:93)
                        at org.junit.jupiter.engine.execution.NamespaceAwareStore.getOrComputeIfAbsent(NamespaceAwareStore.java:61)
                        at org.springframework.test.context.junit.jupiter.SpringExtension.getTestContextManager(SpringExtension.java:294)
                        at org.springframework.test.context.junit.jupiter.SpringExtension.beforeAll(SpringExtension.java:113)
                        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeBeforeAllCallbacks$8(ClassBasedTestDescriptor.java:368)
                        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
                        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeBeforeAllCallbacks(ClassBasedTestDescriptor.java:368)
                        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.before(ClassBasedTestDescriptor.java:192)
                        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.before(ClassBasedTestDescriptor.java:78)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$5(NodeTestTask.java:136)
                        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$7(NodeTestTask.java:129)
                        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:127)
                        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:126)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:84)
                        at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
                        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:38)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$5(NodeTestTask.java:143)
                        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$7(NodeTestTask.java:129)
                        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:127)
                        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:126)
                        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:84)
                        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:32)
                        at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
                        at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:51)
                        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:108)
                        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)
                        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)
                        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)
                        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)
                        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:96)
                        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:84)
                        at org.eclipse.jdt.internal.junit5.runner.JUnit5TestReference.run(JUnit5TestReference.java:98)
                        at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:40)
                        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:529)
                        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:756)
                        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:452)
                        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:210)                    
                    </code></pre>
                    @ContextConfigurationã‹@SpringBootTestã®æŒ‡å®šãŒå¿…è¦ã¨æ€’ã‚‰ã‚Œã¦ã„ã‚‹ã€‚@MyBatisTestã§è‰¯ã„ã¨ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«ã¯è¨˜è¼‰ãŒã‚ã‚‹ãŒã€‚ã€‚ã€‚
                    <br>
                    è¦ªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆæ™‚ã«tororial.example.comã¨ã—ãŸã›ã„ã§SpringBootã®èµ·å‹•ã‚¯ãƒ©ã‚¹(TurorialApplication)ãŒåˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å­˜åœ¨ã—ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒèªè­˜ã§ããšã«ãŠã“ã£ãŸã‚¨ãƒ©ãƒ¼ã ã£ãŸã€‚TurorialApplicationã‚’åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ç§»å‹•ã•ã›ãŸã‚‰ã©ã‚Šã‚ãˆãšãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ããŸ
                    <br>
                    æ¬¡ã¯å…¨ãƒ†ã‚¹ãƒˆãŒNGã¨ãªã£ãŸã€‚ã€‚ã€‚ãƒ†ãƒ¼ãƒ–ãƒ«TODOãŒè¦‹ã¤ã‹ã‚‰ãªã„ã¨ã®ã“ã¨ã€‚schema.sqlã§ä½œã£ãŸã¯ãšã§ã™ãŒã€‚ã€‚ã€‚
                    èª¿ã¹ãŸãŒåˆ†ã‹ã‚‰ãšã€application.yamlã‹ã‚‰application.propertiesã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´ã—ã€ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š(è¨˜è¼‰ãªã—ã§æœ¬æ¥ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã•ã‚Œã‚‹ã¯ãšã®ã‚‚ã®)ã‚’è¨­å®šã—ã€ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œã—ãŸã¨ã“ã‚ã€èµ·å‹•æ™‚ã«ãªãœã‹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã¡ã‚ƒã‚“ã¨ä½œæˆã§ãã€ãƒ†ã‚¹ãƒˆãŒå…¨ã¦æ­£å¸¸çµ‚äº†ã—ãŸã€‚
                    <pre><code>
                        spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=false
                        spring.datasource.username=sa
                        spring.datasource.password=
                        spring.datasource.driver-class-name=org.h2.Driver
                        spring.datasource.initialization-mode=embedded
                    </code></pre>
                </ul>
                <h2 id="createservice"><a class="anchor" href="#createservice"></a>5.7 Serviceã®ä½œæˆ</h2>
                Todoãƒªã‚½ãƒ¼ã‚¹ã®å–å¾—ã€ç™»éŒ²ã€å‰Šé™¤ã€å®Œäº†ã‚’è¡Œã†æ¥­å‹™å‡¦ç†ã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã€‚
                <ul>
                    <h3 id="createexception"><a class="anchor" href="#createexception"></a>5.7.1 ä¾‹å¤–å‡¦ç†ã‚¯ãƒ©ã‚¹ã®ä½œæˆ</h3>
                    BusinessExceptionã‚¯ãƒ©ã‚¹ã¨ResourceNotFoundExceptionã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
                    <li>BusinesExceptionã‚¯ãƒ©ã‚¹ã®ä½œæˆ</li>
                    <ul>
                    <table width=500>
                        <tr>
                            <th>é …ç›®å</th>
                            <th>è¨­å®šå€¤</th>
                        </tr>
                        <tr>
                            <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                            <td>turorial/src/main/java</td>
                        </tr>
                        <tr>
                           <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                           <td>com.example.tutorial.common.exception</td>
                       </tr>
                       <tr>
                           <td>åå‰</td>
                            <td>BusinessException</td>
                        </tr>
                        <tr>
                            <td>ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹</td>
                             <td>java.lang.RuntimeException</td>
                         </tr>
                    </table>
                    <br>
                    <pre><code>
                        package com.example.tutorial.common.exception;

                        import org.springframework.http.HttpStatus;
                        import org.springframework.web.bind.annotation.ResponseStatus;
                        
                        @ResponseStatus(code = HttpStatus.CONFLICT)
                        public class BusinessException extends RuntimeException {
                        
                            private static final long serialVersionUID = 1L;
                        
                            public BusinessException(String message) {
                                super(message);
                            }
                        
                            public BusinessException(String message, Throwable cause) {
                                super(message, cause);
                            }
                        
                        }
                    </code></pre>
                    <table width=500>
                        <tr>
                            <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                            <th>ãƒ¡ãƒ¢</th>
                        </tr>
                        <tr>
                            <td>@ResponseStatus</td>
                            <td>å¼•æ•°ã‚’é€šã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”å´ã™ã‚‹ãŸã‚ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚code = HttpStatus.CONFLICTã§ã€409ã‚’è¿”å´ã™ã‚‹ã€‚ä¸€èˆ¬çš„ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰åã¨ç´ã¥ã„ã¦ã„ã‚‹ã‚ˆã†ã€‚<a href="https://developer.mozilla.org/ja/docs/Web/HTTP/Status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã€‚</a></td>
                        </tr>
                        <tr>
                            <td>java.lang.RuntimeExceptionã‚’ç¶™æ‰¿</td>
                            <td>RuntimeExceptionã¯ã‚¢ãƒ—ãƒªã‚’é‹ç”¨ã™ã‚‹ä¸­ã§èµ·ã“ã‚‹å›å¾©ä¸è¦ãªä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹ã‚¯ãƒ©ã‚¹ã€‚<a href="https://programmer-life.work/java/runtime-exception-java">java.lang.RuntimeExceptionã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã€‚</a><br>
                            super(message)ã§è¦ªã‚¯ãƒ©ã‚¹ã§ã‚ã‚‹RuntimeExceptionã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’messageã‚’å¼•æ•°ã«ã—ã¦å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã€‚<a href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/RuntimeException.html">java.lang.RuntimeExceptionã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã€‚</a>
                            </td>
                        </tr>
                    </table>
                </ul>
                    <li>ResourceNotFoundExceptionã‚¯ãƒ©ã‚¹</li>
                    <ul>
                    <table width=500>
                        <tr>
                            <th>é …ç›®å</th>
                            <th>è¨­å®šå€¤</th>
                        </tr>
                        <tr>
                            <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                            <td>turorial/src/main/java</td>
                        </tr>
                        <tr>
                           <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                           <td>com.example.tutorial.common.exception</td>
                       </tr>
                       <tr>
                           <td>åå‰</td>
                            <td>ResourceNotFoundException</td>
                        </tr>
                        <tr>
                            <td>ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹</td>
                             <td>java.lang.RuntimeException</td>
                        </tr>
                    </table>
                    ç‰¹ã«ç•™æ„äº‹é …ã¯ãªã„ã€‚
                </ul>
                <h3 id="createserviceif"><a class="anchor" href="#createserviceif"></a>5.7.2 TodoServiceã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä½œæˆ</h3>
                ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä»¥ä¸‹ã®é€šã‚Šä½œæˆã™ã‚‹ã€‚
                <table width=500>
                    <tr>
                        <th>é …ç›®å</th>
                        <th>è¨­å®šå€¤</th>
                    </tr>
                    <tr>
                        <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                        <td>turorial/src/main/java</td>
                    </tr>
                    <tr>
                       <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                       <td>com.example.tutorial.todo</td>
                   </tr>
                   <tr>
                       <td>åå‰</td>
                        <td>TodoService</td>
                    </tr>
                </table>
                <pre><code>
                    package com.example.tutorial.todo;

                    import java.util.Collection;
                    
                    public interface TodoService {
                    
                        Todo findOne(Long todoId);
                    
                        Collection<Todo> findAll();
                    
                        Todo create(Todo todo);
                    
                        Todo finish(Long todoId);
                    
                        void delete(Long todoId);
                    }
                </code></pre>
                <table width=500>
                    <tr>
                        <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                        <th>ãƒ¡ãƒ¢</th>
                    </tr>
                    <tr>
                        <td>è¨˜è¿°ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦</td>
                        <td>å¾Œç¶šã§å®Ÿè£…ã™ã‚‹æ¥­å‹™å‡¦ç†ã§ã‚ã‚‹ã€æ¤œç´¢ã€å…¨ä»¶æ¤œç´¢ã€ä½œæˆã€å®Œäº†ã€å‰Šé™¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚å…·ä½“çš„ãªãƒ­ã‚¸ãƒƒã‚¯ã®è¨˜è¼‰ã¯implå´ã«è¨˜è¼‰ã™ã‚‹ã®ã§ä¸è¦ã€‚ãªãŠã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰å‘¼ã³å‡ºã™éš›ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€å®Ÿè£…ã®æ”¹ä¿®ã«å¼·ã„ã‚¢ãƒ—ãƒªã®ä½œã‚Šã«ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã€‚ãªãœã€å®Ÿè£…å´ã§ã¯ãªãã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å‘¼ã³å‡ºã—ã¦å‹•ãã®ã‹ã¯ç–‘å•ã€‚</td>
                    </tr>
                </table>
                <h3 id="createserviceimpl"><a class="anchor" href="#createserviceimpl"></a>5.7.3 TodoServiceImplã‚¯ãƒ©ã‚¹ã®ä½œæˆ</h3>
                ã‚¯ãƒ©ã‚¹ã‚’ä»¥ä¸‹ã®é€šã‚Šä½œæˆã™ã‚‹ã€‚
                <table width=500>
                    <tr>
                        <th>é …ç›®å</th>
                        <th>è¨­å®šå€¤</th>
                    </tr>
                    <tr>
                        <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                        <td>turorial/src/main/java</td>
                    </tr>
                    <tr>
                       <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                       <td>com.example.tutorial.todo</td>
                   </tr>
                   <tr>
                       <td>åå‰</td>
                        <td>TodoServiceImpl</td>
                    </tr>
                    <tr>
                        <td>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</td>
                         <td>com.example.tutorial.TodoService</td>
                     </tr>
                </table>
                <pre><code>
                    package com.example.tutorial.todo;

                    import java.time.LocalDateTime;
                    import java.util.Collection;
                    import org.springframework.beans.factory.annotation.Autowired;
                    import org.springframework.stereotype.Service;
                    import org.springframework.transaction.annotation.Transactional;
                    import com.example.tutorial.common.exception.BusinessException;
                    import com.example.tutorial.common.exception.ResourceNotFoundException;
                    
                    @Service // (1)
                    @Transactional // (2)
                    public class TodoServiceImpl implements TodoService {
                    
                        private static final long MAX_UNFINISHED_COUNT = 5;
                    
                        @Autowired // (3)
                        TodoRepository todoRepository;
                    
                        @Override
                        public Todo findOne(Long todoId) {
                            return todoRepository.findById(todoId).orElseThrow(() -> new ResourceNotFoundException(
                                    "The requested Todo is not found. (id=" + todoId + ")"));
                        }
                    
                        @Override
                        public Collection<Todo> findAll() {
                            return todoRepository.findAll();
                        }
                    
                        @Override
                        public Todo create(Todo todo) {
                            long unfinishedCount = todoRepository.countByFinished(false);
                            if (unfinishedCount >= MAX_UNFINISHED_COUNT) {
                                throw new BusinessException(
                                        "The count of un-finished Todo must not be over " + MAX_UNFINISHED_COUNT + ".");
                            }
                    
                            LocalDateTime createdAt = LocalDateTime.now();
                            todo.setCreatedAt(createdAt);
                            todo.setFinished(false);
                    
                            todoRepository.create(todo);
                            return todo;
                        }
                    
                        @Override
                        public Todo finish(Long todoId) {
                            Todo todo = findOne(todoId);
                            if (todo.isFinished()) {
                                throw new BusinessException(
                                        "The requested Todo is already finished. (id=" + todoId + ")");
                            }
                            todo.setFinished(true);
                            todoRepository.updateById(todoId);
                            return todo;
                        }
                    
                        @Override
                        public void delete(Long todoId) {
                            findOne(todoId);
                            todoRepository.deleteById(todoId);
                        }
                    
                    }                </code></pre>
                <table width=500>
                    <tr>
                        <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                        <th>ãƒ¡ãƒ¢</th>
                    </tr>
                    <tr>
                        <td>@Service</td>
                        <td>ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦Beanç™»éŒ²ã™ã‚‹ãŸã‚ã®è¨˜è¿°ã€‚ãŠãã‚‰ãã“ã®è¨˜è¿°ã§SpringBootãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä¸Šã§Controllerã‹ã‚‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†ãªã©ãŒå¯èƒ½ã«ãªã‚‹ç†è§£</td>
                    </tr>
                    <tr>
                        <td>@Transactional</td>
                        <td>ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å®£è¨€ã€‚ã“ã“ã®è¨­å®šã¯ã„ã‚ã„ã‚ã‚ã‚‹ãŒã€å‰²æ„›ã€‚</td>
                    </tr>
                    <tr>
                        <td>ä»–ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šå–ã‚Šã€‚</td>
                        <td>Todoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’è©°ã‚ã¦ã€ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ(Repositoryãªã©)ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã—ã¦ã„ã‚‹ã€‚Todo.javaã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚„ã‚Šã¨ã‚Šã®å½¢å¼ã‚’å®šç¾©ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã§TodoResourceã‚¯ãƒ©ã‚¹ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šå–ã‚Šã®å½¢å¼ã‚’å®šç¾©ã—ãŸã‚¯ãƒ©ã‚¹ã¨ç†è§£ã€‚</td>
                    </tr>
                </table>
                <h3 id="testservice"><a class="anchor" href="#testeservice"></a>5.7.4 Serviceã®å˜ä½“ãƒ†ã‚¹ãƒˆ</h3>
                TodoServiceã®å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã€‚ä¾å­˜ã‚¯ãƒ©ã‚¹ãŒã¾ã å®Œæˆã—ã¦ã„ãªã„å ´åˆã«ä¾å­˜ã‚¯ãƒ©ã‚¹ã®ãƒ¢ãƒƒã‚¯åŒ–ã‚’è¡Œã†ã€‚<a href="https://qiita.com/Fudeko/items/301f8a80963dfcaafb80">ãƒ¢ãƒƒã‚¯åŒ–ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã€‚</a>
                <br>
                ä»Šå›ã¯ä½œæˆæ¸ˆã¿ã§ã¯ã‚ã‚‹ãŒç·´ç¿’ã®ãŸã‚ã«todoRepsitoryã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€todoRepositoryã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ©ç”¨ã›ãšã€todoRepositoryã®ãƒªã‚¿ãƒ¼ãƒ³ã‚’å›ºå®šå€¤ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚
                <table width=500>
                    <tr>
                        <th>é …ç›®å</th>
                        <th>è¨­å®šå€¤</th>
                    </tr>
                    <tr>
                        <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                        <td>turorial/src/test/java</td>
                    </tr>
                    <tr>
                       <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                       <td>com.example.tutorial.todo</td>
                   </tr>
                   <tr>
                       <td>åå‰</td>
                        <td>TodoServiceTest</td>
                    </tr>
                </table>
                <pre><code>
                    package com.example.tutorial.todo;

                    import static org.assertj.core.api.Assertions.assertThat;
                    import static org.mockito.BDDMockito.given;
                    import static org.mockito.BDDMockito.then;
                    import static org.mockito.BDDMockito.willDoNothing;
                    import static org.mockito.Mockito.times;
                    import java.time.LocalDateTime;
                    import java.time.format.DateTimeFormatter;
                    import java.util.Arrays;
                    import java.util.Collection;
                    import java.util.Objects;
                    import java.util.Optional;
                    import org.junit.jupiter.api.DisplayName;
                    import org.junit.jupiter.api.Test;
                    import org.mockito.ArgumentMatchers;
                    import org.springframework.beans.factory.annotation.Autowired;
                    import org.springframework.boot.test.context.SpringBootTest;
                    import org.springframework.boot.test.mock.mockito.MockBean;
                    
                    @SpringBootTest(classes = TodoServiceImpl.class) // (1)
                    public class TodoServiceTest {
                    
                        private static final DateTimeFormatter DATETIME_FORMAT = DateTimeFormatter.ofPattern("uuuu/MM/dd HH:mm:ss");
                    
                        @Autowired
                        private TodoService todoService; // (2)
                    
                        @MockBean
                        private TodoRepository todoRepository; // (3)
                    
                        @Test
                        @DisplayName("å…¨TodoãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(service)")
                        void testFindAll() {
                            // setup
                            Todo expectTodo1 = new Todo(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
                            Todo expectTodo2 = new Todo(2L, "sample todo 2", true, LocalDateTime.parse("2019/09/19 02:02:02", DATETIME_FORMAT));
                            Todo expectTodo3 = new Todo(3L, "sample todo 3", false, LocalDateTime.parse("2019/09/19 03:03:03", DATETIME_FORMAT));
                    
                            // setup mocks
                            given(todoRepository.findAll()).willReturn(Arrays.asList(expectTodo1, expectTodo2, expectTodo3));
                    
                            // run
                            Collection<Todo> actualTodos = todoService.findAll();
                    
                            // check
                            then(todoRepository).should(times(1)).findAll();
                            assertThat(actualTodos).usingFieldByFieldElementComparator().containsExactly(expectTodo1, expectTodo2, expectTodo3);
                        }
                    
                        @Test
                        @DisplayName("todoIdã«å¯¾å¿œã™ã‚‹TodoãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Service)")
                        void testFindOne() {
                            // setup
                            Todo expectTodo = new Todo(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
                    
                            // setup mocks
                            given(todoRepository.findById(1L)).willReturn(Optional.of(expectTodo));
                    
                            // run
                            Todo actualTodo = todoService.findOne(1L);
                    
                            // check
                            then(todoRepository).should(times(1)).findById(ArgumentMatchers.longThat(arg -> arg == actualTodo.getTodoId()));
                            assertThat(actualTodo).isEqualToComparingFieldByField(expectTodo);
                        }
                    
                        @Test
                        @DisplayName("æ–°ãŸãªTodoãŒä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(service)")
                        void testCreate() {
                            // setup
                            Todo expectTodo = new Todo(null, "sample todo 4", false, null);
                    
                            // setup mocks
                            willDoNothing().given(todoRepository).create(expectTodo);
                    
                            // run
                            todoService.create(expectTodo);
                    
                            // check
                            then(todoRepository).should(times(1)).create(
                                    ArgumentMatchers.<Todo>argThat(
                                            arg -> expectTodo.getTodoTitle().equals(arg.getTodoTitle())
                                            && !arg.isFinished()
                                            && Objects.nonNull(arg.getCreatedAt())
                                            )
                                    );
                        }
                    
                        @Test
                        @DisplayName("todoId=1ã®finishedãŒtrueã«ãªã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(service)")
                        void testFinish() {
                            // setup
                            Todo expectTodo = new Todo(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
                    
                            // setup mocks
                            given(todoRepository.findById(1L)).willReturn(Optional.of(expectTodo));
                            given(todoRepository.updateById(1L)).willReturn(1L);
                    
                            // run
                            todoService.finish(1L);
                    
                            // check
                            then(todoRepository).should(times(1)).findById(ArgumentMatchers.longThat(arg -> arg == expectTodo.getTodoId()));
                            then(todoRepository).should(times(1)).updateById(ArgumentMatchers.longThat(arg -> arg == 1L));
                        }
                    
                        @Test
                        @DisplayName("todoId=1ãŒDeleteã«ã‚ˆã£ã¦å‰Šé™¤ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(service)")
                        void testDelete() {
                            // setup
                            Todo expectTodo = new Todo(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
                    
                            // setup mocks
                            given(todoRepository.findById(1L)).willReturn(Optional.of(expectTodo));
                            given(todoRepository.deleteById(1L)).willReturn(1L);
                    
                            // run
                            todoService.delete(1L);
                    
                            // check
                            then(todoRepository).should(times(1)).findById(ArgumentMatchers.longThat(arg -> arg == expectTodo.getTodoId()));
                            then(todoRepository).should(times(1)).deleteById(ArgumentMatchers.longThat(arg -> arg == 1L));
                        }
                    }
                </code></pre>
                <table width=500>
                    <tr>
                        <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                        <th>ãƒ¡ãƒ¢</th>
                    </tr>
                    <tr>
                        <td>@SpringBootTest(classes = TodoServiceImpl.class)</td>
                        <td>SpringTestã®å®Ÿè¡Œå¯¾è±¡ã®ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹ã€‚Repositoryã®ãƒ†ã‚¹ãƒˆã§ã¯@MyBatisTestã‚’æŒ‡å®šã—ãŸãŒã€ã“ã‚Œã¯MyBaticå°‚ç”¨ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚é€šå¸¸ã¯@SpringBootTestã‚’æŒ‡å®šã™ã‚‹ã€‚</td>
                    </tr>
                    <tr>
                        <td>@MockBean</td>
                        <td>ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ä¾å­˜ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã€‚ä»Šå›ã¯todoRepositoryã‚’æŒ‡å®šã€‚</td>
                    </tr>
                    <tr>
                        <td>given(todoRepository.findAll()).willReturn(Arrays.asList(expectTodo1, expectTodo2, expectTodo3));</td>
                        <td>ãƒ¢ãƒƒã‚¯ã®å®Ÿè£…ã€‚todoRepository.findAll()ãŒè¿”å´ã™ã‚‹ã§ã‚ã‚ã†å€¤ã‚’Arrays.asList(expectTodo1, expectTodo2, expectTodo3)ã«å›ºå®šåŒ–ã—ã¦ã„ã‚‹ã€‚(å®Ÿéš›ã®todoRepositoryã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ©ç”¨ã—ãªã„ã€‚)</td>
                    </tr>
                </table>
                <h3 id="doservicetest"><a class="anchor" href="#doservicetest"></a>5.7.5 TodoServiceã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h3>
                TodoService.javaã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€JUnitã‚’å®Ÿè¡Œã™ã‚‹ã€‚ã‚ªãƒ¼ãƒ«ã‚°ãƒªãƒ¼ãƒ³ã«ãªã‚Œã°æ­£å¸¸çµ‚äº†ã€‚(ã‚¨ãƒ©ãƒ¼ã¯å‡ºãšã€ã€ã€)
                </ul>
                <h2 id="createctl"><a class="anchor" href="#createctl"></a>6. Controllerã‚¯ãƒ©ã‚¹ã®ä½œæˆ</h2>
                ã‚¯ãƒ©ã‚¹ã‚’ä»¥ä¸‹ã®é€šã‚Šä½œæˆã™ã‚‹ã€‚
                <table width=500>
                    <tr>
                        <th>é …ç›®å</th>
                        <th>è¨­å®šå€¤</th>
                    </tr>
                    <tr>
                        <td>ã‚½ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€</td>
                        <td>turorial/src/main/java</td>
                    </tr>
                    <tr>
                       <td>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</td>
                       <td>com.example.tutorial.todo</td>
                   </tr>
                   <tr>
                       <td>åå‰</td>
                        <td>TodoContoroller</td>
                    </tr>
                </table>
                <pre><code>
                    package com.example.tutorial.todo;

                    import java.util.Collection;
                    import java.util.List;
                    import java.util.stream.Collectors;
                    import org.springframework.http.HttpStatus;
                    import org.springframework.validation.annotation.Validated;
                    import org.springframework.beans.factory.annotation.Autowired;
                    import org.springframework.web.bind.annotation.DeleteMapping;
                    import org.springframework.web.bind.annotation.GetMapping;
                    import org.springframework.web.bind.annotation.PathVariable;
                    import org.springframework.web.bind.annotation.PostMapping;
                    import org.springframework.web.bind.annotation.PutMapping;
                    import org.springframework.web.bind.annotation.RequestBody;
                    import org.springframework.web.bind.annotation.RequestMapping;
                    import org.springframework.web.bind.annotation.ResponseStatus;
                    import org.springframework.web.bind.annotation.RestController;
                    import com.github.dozermapper.core.Mapper;
                    
                    @RestController // (1)
                    @RequestMapping("todos") // (2)
                    public class TodoController {
                    
                        @Autowired // (3)
                        TodoService todoService;
                    
                        @Autowired // (4)
                        Mapper beanMapper;
                    
                        @GetMapping
                        public List<TodoResource> getTodos() {
                            Collection<Todo> todos = todoService.findAll();
                            return todos.stream().map(todo -> beanMapper.map(todo, TodoResource.class))
                                    .collect(Collectors.toList());
                        }
                    
                        @GetMapping("{todoId}")
                        public TodoResource getTodo(@PathVariable("todoId") Long todoId) {
                            Todo todo = todoService.findOne(todoId);
                            return beanMapper.map(todo, TodoResource.class);
                        }
                    
                        @PostMapping
                        @ResponseStatus(HttpStatus.CREATED)
                        public TodoResource postTodo(@RequestBody @Validated TodoResource todoResource) {
                            Todo createdTodo = todoService.create(beanMapper.map(todoResource, Todo.class));
                            return beanMapper.map(createdTodo, TodoResource.class);
                        }
                    
                        @PutMapping("{todoId}")
                        public TodoResource putTodo(@PathVariable("todoId") Long todoId) {
                            Todo finishedTodo = todoService.finish(todoId);
                            return beanMapper.map(finishedTodo, TodoResource.class);
                        }
                    
                        @DeleteMapping("{todoId}")
                        @ResponseStatus(HttpStatus.NO_CONTENT)
                        public void deleteTodo(@PathVariable("todoId") Long todoId) {
                            todoService.delete(todoId);
                        }
                    
                    }
                </code></pre>
                <table>
                <tr>
                    <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                    <th>ãƒ¡ãƒ¢</th>
                </tr>
                <tr>
                    <td>@RestController</td>
                    <td>RestAPIç”¨ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å—ä»˜ã‘ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã«ã¯JSONã‚’åŸ‹ã‚è¾¼ã‚€ã‚ˆã†ã«ãªã‚‹ã€‚</td>
                </tr>
                <tr>
                    <td>beanMapper.map(todo, TodoResource.class)</td>
                    <td>å„å‡¦ç†ã§ã¯ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å—ã‘å–ã£ãŸtodoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–ã‚Šæ‰±ã†ãŒã€ã“ã®ã¾ã¾ã§ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”å´å‡ºæ¥ãªã„ãŸã‚ã€beanMapperã«ã‚ˆã‚Šã€TodoResource.classã«å¤‰æ›ã—ã¦ã„ã‚‹ã€‚å…·ä½“çš„ã«ã¯ã€todoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨TodoResource.classã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã€ã‚³ãƒ”ãƒ¼ã—ã¦ã„ã‚‹ã€‚</td>
                </tr>
                <tr>
                    <td>@RequestMapping("todos") </td>
                    <td>ãƒªã‚¯ã‚¨ã‚¹ãƒˆURLã‚’ã“ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã„ã‚‹ã€‚ä»¥é™ã§ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå®šç¾©ã•ã‚Œã€ä¸­ã«ã¯å¼•æ•°ãŒå…¥ã£ã¦ã„ã‚‹ã‚‚ã®ãŒã‚ã‚‹ãŒã€ã“ã‚Œã‚‚URLã§ã‚ã‚Šã€todos/todoIdã§å®šç¾©ã•ã‚Œã‚‹ã€‚</td>
                </tr>
            </table>
                Contorollerã®ãƒ†ã‚¹ãƒˆã®ã‚„ã‚Šæ–¹ã¯TodoServicã¨ã»ã¼åŒã˜(ä»Šå›ã¯TodoServiceã‚’ãƒ¢ãƒƒã‚¯åŒ–)ã€‚ä»¥ä¸‹ã«æ¦‚è¦ã‚’è¨˜è¼‰ã™ã‚‹ã€‚
                <ol>
                    <li>TodoControllerTestã‚’ä½œæˆã™ã‚‹ã€‚</li>
                    <li>ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
                        <pre><code>
                            package com.example.tutorial.todo;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.BDDMockito.given;
import static org.mockito.BDDMockito.then;
import static org.mockito.Mockito.times;
import java.net.URI;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Arrays;
import java.util.Collection;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.mockito.ArgumentMatchers;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.boot.test.web.client.TestRestTemplate;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.http.RequestEntity;
import org.springframework.http.ResponseEntity;
import com.github.dozermapper.core.Mapper;

@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT) // (1)
public class TodoControllerTest {

    private static final DateTimeFormatter DATETIME_FORMAT = DateTimeFormatter.ofPattern("uuuu/MM/dd HH:mm:ss");

    @Autowired // (2)
    private TestRestTemplate testRestTemplate;

    @Autowired
    private Mapper beanMapper;

    @MockBean // (3)
    private TodoService todoService;

    @Test
    @DisplayName("GET TodosãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Controller)")
    void testGetTodos() {
        // setup
        Todo expectTodo1 = new Todo(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
        Todo expectTodo2 = new Todo(2L, "sample todo 2", true, LocalDateTime.parse("2019/09/19 02:02:02", DATETIME_FORMAT));
        Collection<Todo> expectTodos = Arrays.asList(expectTodo1, expectTodo2);
        TodoResource[] expectTodoResources = expectTodos.stream()
                .map(todo -> beanMapper.map(todo, TodoResource.class)).toArray(TodoResource[]::new);

        // setup mocks
        given(todoService.findAll()).willReturn(expectTodos);

        // run
        ResponseEntity<TodoResource[]> actualResponseEntity =
                testRestTemplate.getForEntity("/todos", TodoResource[].class);

        // check
        then(todoService).should(times(1)).findAll();
        assertThat(actualResponseEntity.getBody()).usingFieldByFieldElementComparator().containsExactly(expectTodoResources[0], expectTodoResources[1]);
        assertThat(actualResponseEntity.getStatusCode()).isEqualTo(HttpStatus.OK);
    }

    @Test
    @DisplayName("GET TodoãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Controller)")
    void testGetTodo(){
        // setup
        Todo expectTodo = new Todo(1L, "sample todo 1", false, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
        TodoResource expectTodoResource = beanMapper.map(expectTodo, TodoResource.class);

        // setup mocks
        given(this.todoService.findOne(1L)).willReturn(expectTodo);

        // run
        ResponseEntity<TodoResource> actualResponseEntity =
                testRestTemplate.getForEntity("/todos/1", TodoResource.class);

        // check
        then(todoService).should(times(1)).findOne(ArgumentMatchers.longThat(arg -> arg == expectTodo.getTodoId()));
        assertThat(actualResponseEntity.getBody()).isEqualToComparingFieldByField(expectTodoResource);
        assertThat(actualResponseEntity.getStatusCode()).isEqualTo(HttpStatus.OK);
    }

    @Test
    @DisplayName("POST TodoãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Controller)")
    void testPostTodo() {
        // setup
        TodoResource inputTodoResource = new TodoResource();
        inputTodoResource.setTodoTitle("sample todo 4");
        Todo inputTodo = beanMapper.map(inputTodoResource, Todo.class);
        Todo expectTodo = new Todo(4L, "sample todo 4", false, LocalDateTime.parse("2019/09/19 04:04:04", DATETIME_FORMAT));
        TodoResource expectTodoResource = beanMapper.map(expectTodo, TodoResource.class);

        // setup mocks
        given(this.todoService.create(any(Todo.class))).willReturn(expectTodo);

        // run
        ResponseEntity<TodoResource> actualResponseEntity =
                testRestTemplate.postForEntity("/todos", inputTodoResource, TodoResource.class);

        // check
        then(todoService).should(times(1)).create(ArgumentMatchers.<Todo>argThat(arg -> inputTodo.getTodoTitle().equals(arg.getTodoTitle())));
        assertThat(actualResponseEntity.getBody()).isEqualToComparingFieldByField(expectTodoResource);
        assertThat(actualResponseEntity.getStatusCode()).isEqualTo(HttpStatus.CREATED);
    }

    @Test
    @DisplayName("PUT TodoãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Controller)")
    void testPutTodo() {
        // setup
        Todo expectTodo = new Todo(1L, "sample todo 1", true, LocalDateTime.parse("2019/09/19 01:01:01", DATETIME_FORMAT));
        TodoResource expectTodoResource = beanMapper.map(expectTodo, TodoResource.class);

        // setup mocks
        given(this.todoService.finish(1L)).willReturn(expectTodo);

        // run
        RequestEntity<String> actualRequestEntity =
                RequestEntity.put(URI.create("/todos/1")).body("");
        ResponseEntity<TodoResource> actualResponseEntity =
                testRestTemplate.exchange(actualRequestEntity, TodoResource.class);

        // check
        then(todoService).should(times(1)).finish(ArgumentMatchers.longThat(arg -> arg == expectTodo.getTodoId()));
        assertThat(actualResponseEntity.getBody()).isEqualToComparingFieldByField(expectTodoResource);
        assertThat(actualResponseEntity.getStatusCode()).isEqualTo(HttpStatus.OK);
    }

    @Test
    @DisplayName("DELETE TodoãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹(Controller)")
    void testDeleteTodo() {
        // run
        ResponseEntity<String> actualResponseEntity =
                testRestTemplate.exchange("/todos/1", HttpMethod.DELETE, HttpEntity.EMPTY, String.class);

        // check
        then(todoService).should(times(1)).delete(ArgumentMatchers.longThat(arg -> arg == 1L));
        assertThat(actualResponseEntity.getBody()).isNull();
        assertThat(actualResponseEntity.getStatusCode()).isEqualTo(HttpStatus.NO_CONTENT);
    }

}
                        </code></pre>
                    </li>
                </ol>
                <table>
                    <tr>
                        <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                        <th>ãƒ¡ãƒ¢</th>
                    </tr>
                    <tr>
                        <td>ã‚¢ãƒ­ãƒ¼é–¢æ•°</td>
                        <td>todo -> beanMapper.map(todo, TodoResource.class)).toArray(TodoResource[]::new)ã®è¨˜è¿°ã¯ãŠãã‚‰ãJavaScriptã®ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¨åŒã˜è¨˜æ³•(Javaã§ã¯ãƒ©ãƒ ãƒ€å¼ã¨ã„ã†ã‚‰ã—ã„)<br>
                        ã‚¯ãƒ©ã‚¹å::newã®è¨˜è¿°ã§ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‚ç…§ã—ã¦ã„ã‚‹ã€‚<a href="https://www.sejuku.net/blog/22592">ã“ã¡ã‚‰ã‚’å‚ç…§ã€‚</a><br>
                        ä»Šå›ã¯TodoResourceã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ç”Ÿæˆã—ã€toArrayã®å¼•æ•°ã«æ¸¡ã™ã“ã¨ã§ã€TodoResource.classã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸexceptTodosã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®è¦ç´ ã‹ã‚‰TodoResourceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ§‹æˆã•ã‚Œã‚‹Allayã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã€‚
                        ã‚ã–ã‚ã–Allayã«ã—ã¦ã„ã‚‹ã®ã¯ã“ã®å¾Œã®assertThatã§æœŸå¾…çµæœ(expectTodoResources)ã¨å®Ÿéš›ã®çµæœ(actualResponseEntity.getBody())ã‚’æ¯”è¼ƒã™ã‚‹éš›ã«actualResponseEntity.getBody()ãŒtestRestTemplateã®ä»•æ§˜ã§Allayã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã¨ç†è§£ã€‚
                        </td>
                    </tr>
                    <tr>
                        <td>beanMapper.map(todo, TodoResource.class)</td>
                        <td>å„å‡¦ç†ã§ã¯ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å—ã‘å–ã£ãŸtodoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–ã‚Šæ‰±ã†ãŒã€ã“ã®ã¾ã¾ã§ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”å´å‡ºæ¥ãªã„ãŸã‚ã€beanMapperã«ã‚ˆã‚Šã€TodoResource.classã«å¤‰æ›ã—ã¦ã„ã‚‹ã€‚å…·ä½“çš„ã«ã¯ã€todoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨TodoResource.classã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã€ã‚³ãƒ”ãƒ¼ã—ã¦ã„ã‚‹ã€‚</td>
                    </tr>
                    <tr>
                        <td>@RequestMapping("todos") </td>
                        <td>ãƒªã‚¯ã‚¨ã‚¹ãƒˆURLã‚’ã“ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã„ã‚‹ã€‚ä»¥é™ã§ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå®šç¾©ã•ã‚Œã€ä¸­ã«ã¯å¼•æ•°ãŒå…¥ã£ã¦ã„ã‚‹ã‚‚ã®ãŒã‚ã‚‹ãŒã€ã“ã‚Œã‚‚URLã§ã‚ã‚Šã€todos/todoIdã§å®šç¾©ã•ã‚Œã‚‹ã€‚</td>
                    </tr>
                </table>
    
            </ul>            
</ul>
</body>
</html>
                             