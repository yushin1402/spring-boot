
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Spring Boot サンプルアプリ作成</title>
<title>Spring Boot Development Reference</title>
</head>
<body id="Tutorial" class="book toc2 toc-left">
<div id="header">
<h1>Spring Boot サンプルアプリ作成</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#env">1. 環境整備</a>
<ul class="sectlevel2">
<li><a href="#apiclient">1.1 API実行クライアント</a>
<li><a href="#ide">1.2 統合開発環境</a>
</ul>
<li><a href="#createproj">2. プロジェクトの作成</a>
<li><a href="#commitproj">3. プロジェクトのコミット</a>
<li><a href="#importproj">4. プロジェクトのインポート</a>
<li><a href="#createapi">4. REST APIの作成</a>
<ul>
    <li><a href="#configurepom">4.1 pom.xmlの設定</a>
    <li><a href="#configureyaml">4.2 application.yamlの設定</a>
</ul>
</div>
</div>
<div id="content">
<h2 id="env"><a class="anchor" href="#env"></a>1. 環境整備</h2>
<p>サンプルアプリを作成するための環境構築を以下の手順で行う。</p>
</div>
<ul class="sectlevel1">
<h3 id="apiclient"><a class="anchor" href="#apicliect"></a>1.1 API実行クライアント</h3>
<p> 
    API実行クライアントにはTalent API Testerを利用する。インストール方法は以下の通り。
</p>
</ul>
<ul class="sectlevel1">
<ol>
    <li type=I>
        <a href="https://chrome.google.com/webstore/detail/talend-api-tester-free-ed/aejoelaoggembcahagimdiliamlcdmfm?hl=ja">
            Talemt API Testerのインストール先にアクセス
        </a>
    </li>
    <li type=I>
        画面右上の「Chromeに追加」を押下。
    </li>
    <li type=I>
        Chromeに正常に追加されたら、画面右上の拡張機能のアイコンよりTalent API Testerを押下する。
    </li>
    <li type=I>
        リクエスト生成画面が表示されたら動作確認完了。
    </li>
</ol>
</ul>
<ul>
<h3 id="ide"><a class="anchor" href="#ide"></a>1.2 統合開発環境</h3>
<p>統合開発環境には、Terasolunaチュートリアル実施時にインストール済みのSTS4.3を利用する。</p>
</ul>
<h2 id="createproj"><a class="anchor" href="#createproj"></a>2. プロジェクトの作成</h2>
<p>
    <a href="https://start.spring.io/">Spring Initializr</a>
    を利用して、Spring Bootのプロジェクトを作成する。手順を以下に示す。
    <ul class="sectlevel1">
        <ol>
            <li type=I>
                <a href="https://start.spring.io/">Spring Initializr</a>
                にアクセスする。
                </a>
            </li>
            <li type=I>
                Spring Initializrの設定画面が表示される。以下の設定値を入力する。
                <ul>
                <p>
                    <table border=1  width=1000>
                        <tr>
                            <th colspan=2>項目名</th>
                            <th>設定値</th>
                            <th>備考</th>
                        </tr>
                        <tr>
                            <td colspan=2>Project</td>
                            <td>Maven Project</td>
                            <td>Mavenでビルドする設定とする。</td>
                        </tr>
                        <tr>
                            <td colspan=2>Language</td>
                            <td>Java</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan=2>Spring Boot</td>
                            <td>2.5.6</td>
                            <td></td>
                        </tr>
                        <tr><td rowspan="8">Project Metadata</td></tr>
                        <tr>
                            <td>Group</td>
                            <td>com.example</td>
                            <td>パッケージを提供するグループを指定する。</td>
                        </tr>
                        <tr>
                            <td>Artifact</td>
                            <td>tutorial</td>
                            <td>プロジェクトの成果物の名前  </td>
                        </tr>
                        <tr>
                            <td>Name</td>
                            <td>tutorial</td>
                            <td>プロジェクトの表示名。 ドキュメントを作成するときなどに使用されます。</td>
                        </tr>
                        <tr>
                            <td>Desription</td>
                            <td>tutorial Project</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Package name</td>
                            <td>com.exaple.com</td>
                            <td>パッケージ名</td>
                        </tr>
                        <tr>
                            <td>Packaging</td>
                            <td>Jar</td>
                            <td>WARでパッケージ化するか、Jarでパッケージ化するかを選択。Jarでパッケージ化すると実行環境を組み込める。</td>
                        </tr>
                        <tr>
                            <td>Java</td>
                            <td>8</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan=2 rowspan=5>
                                Dependancies
                                <br>
                                ※画面右上のADD DEPENDANCIES...から追加
                            </td>
                        </tr>
                        <tr>
                            <td>SpringWeb</td>
                            <td>Webアプリのライブラリ</td>
                        </tr>
                        <tr>
                            <td>Lombok</td>
                            <td>開発効率化のためのソース自動生成ライブラリ</td>
                        </tr>
                        <tr>
                            <td>H2 Database</td>
                            <td>インメモリデータベース</td>
                        </tr>
                        <tr>
                            <td>MyBatis Framework</td>
                            <td>データベースアクセスのフレームワーク</td>
                        </tr>
                    </table>
                </p>
                </ul>
                <li type=I>
                画面下部の GENERATE + ⏎ をクリックする。tutorial.zipがダウンロードされる。
                <li type=I>
                ダウンロードしたzipファイルを作業フォルダで展開する。
                <li type=I>
                展開フォルダ上で以下のコマンドを実行し、動作確認を行う。
                <pre><code>mvn spring-boot:run</code></pre>
                【表示例】
                <pre><code>
                    .
                    .
                    ...pom.xmlに記載のパッケージダウンロード処理
                    .
                    .
                    [INFO] Attaching agents: []

                    .   ____          _            __ _ _
                   /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
                  ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
                   \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
                    '  |____| .__|_| |_|_| |_\__, | / / / /
                   =========|_|==============|___/=/_/_/_/
                   :: Spring Boot ::                (v2.5.6)
                  
                  2021-11-10 01:47:34.489  INFO 11544 --- [           main] c.example.turorial.TurorialApplication   : Starting TurorialApplication using Java 14.0.2 on DESKTOP-VU8QFTR with PID 11544 (C:\study\spring\springboot▒`▒▒▒[▒g▒▒▒A▒▒\▒A▒v▒▒▒쐬\turorial\target\classes started by user in C:\study\spring\springboot▒`▒▒▒[▒g▒▒▒A▒▒\▒A▒v▒▒▒쐬\turorial)
                  2021-11-10 01:47:34.505  INFO 11544 --- [           main] c.example.turorial.TurorialApplication   : No active profile set, falling back to default profiles: default
                  2021-11-10 01:47:35.237  WARN 11544 --- [           main] o.m.s.mapper.ClassPathMapperScanner      : No MyBatis mapper was found in '[com.example.turorial]' package. Please check your configuration.
                  2021-11-10 01:47:35.725  INFO 11544 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
                  2021-11-10 01:47:35.741  INFO 11544 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
                  2021-11-10 01:47:35.741  INFO 11544 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.54]
                  2021-11-10 01:47:35.841  INFO 11544 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
                  2021-11-10 01:47:35.841  INFO 11544 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1267 ms
                  2021-11-10 01:47:36.382  INFO 11544 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
                  2021-11-10 01:47:36.398  INFO 11544 --- [           main] c.example.turorial.TurorialApplication   : Started TurorialApplication in 2.452 seconds (JVM running for 2.899)
                    
                </code></pre>
            </li>
        </ol>
        </ul>
</p>
<h2 id="commitproj"><a class="anchor" href="#commitproj"></a>3. プロジェクトのコミット</h2>
以下手順で作成したSprin BootプロジェクトをGitHubにコミットする。
<ul>
    <ol>
        <li>GitHub上で新規リポジトリを作成する。</li>
        <li>
            以下コマンドでプロジェクトを初期化し、GitHubにpushする。
            <pre><code>
                git init
                echo "# Study Spring Boot" >> README.md
                git add .
                git commit -m "first commit"
                git remote add origin git@github.com:yushin1402/spring-boot.git
                git push -u origin master
            </code></pre>
        </li>
    </ol>
</ul>
<h2 id="importproj"><a class="anchor" href="#importproj"></a>4. プロジェクトのインポート</h2>
以下手順で作成したSprin BootプロジェクトをSTSにインポートする。
<ul>
    <ol>
        <li>ワークスペースに指定するフォルダを作成する。</li>
        <li>作成したフォルダをワークスペースに指定してSTSを起動する。</li>
        <li>ファイル→インポート→Maven>既存Mavenプロジェクトを選んで、次へをクリックする。</li>
        <li>作成したプロジェクトフォルダを選択し、完了する。(pom.xmlがあるフォルダ)</li>
        <li>パッケージエクスプローラにtutorialプロジェクトが表示されたことを確認する。</li>
        <li>
            パッケージを右クリック→実行→SpringBootアプリケーションをクリックし、アプリケーションを起動して動作確認を行う。
            <br>
            以下のようなログがSTSのコンソールに出力され、正常に起動したことを確認出来ればOK。
            <pre><code>
                 .   ____          _            __ _ _
                 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
                ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
                 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
                  '  |____| .__|_| |_|_| |_\__, | / / / /
                 =========|_|==============|___/=/_/_/_/
                [32m :: Spring Boot :: [39m              [2m (v2.5.6)[0;39m

                [2m2021-11-10 02:48:52.487[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mc.example.turorial.TurorialApplication  [0;39m [2m:[0;39m Starting TurorialApplication using Java 16.0.2 on DESKTOP-VU8QFTR with PID 12080 (C:\study\spring\springbootチュートリアル\アプリ作成\turorial\target\classes started by user in C:\study\spring\springbootチュートリアル\アプリ作成\turorial)
                [2m2021-11-10 02:48:52.493[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mc.example.turorial.TurorialApplication  [0;39m [2m:[0;39m No active profile set, falling back to default profiles: default
                [2m2021-11-10 02:48:53.254[0;39m [33m WARN[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.m.s.mapper.ClassPathMapperScanner     [0;39m [2m:[0;39m No MyBatis mapper was found in '[com.example.turorial]' package. Please check your configuration.
                [2m2021-11-10 02:48:53.681[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.s.b.w.embedded.tomcat.TomcatWebServer [0;39m [2m:[0;39m Tomcat initialized with port(s): 8080 (http)
                [2m2021-11-10 02:48:53.691[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.apache.catalina.core.StandardService  [0;39m [2m:[0;39m Starting service [Tomcat]
                [2m2021-11-10 02:48:53.692[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36morg.apache.catalina.core.StandardEngine [0;39m [2m:[0;39m Starting Servlet engine: [Apache Tomcat/9.0.54]
                [2m2021-11-10 02:48:53.779[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.a.c.c.C.[Tomcat].[localhost].[/]      [0;39m [2m:[0;39m Initializing Spring embedded WebApplicationContext
                [2m2021-11-10 02:48:53.779[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mw.s.c.ServletWebServerApplicationContext[0;39m [2m:[0;39m Root WebApplicationContext: initialization completed in 1226 ms
                [2m2021-11-10 02:48:54.413[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mo.s.b.w.embedded.tomcat.TomcatWebServer [0;39m [2m:[0;39m Tomcat started on port(s): 8080 (http) with context path ''
                [2m2021-11-10 02:48:54.424[0;39m [32m INFO[0;39m [35m12080[0;39m [2m---[0;39m [2m[           main][0;39m [36mc.example.turorial.TurorialApplication  [0;39m [2m:[0;39m Started TurorialApplication in 2.392 seconds (JVM running for 3.347)
            </code></pre>
            
            ※<code>maven spring-boot:run</code>でテスト起動したアプリケーションが停止出来ていなかったため、以下のエラー出力となった。
            <pre><code>
                ***************************
                APPLICATION FAILED TO START
                ***************************

                Description:

                Web server failed to start. Port 8080 was already in use.
            </code></pre>
            <code>netstat</code>コマンドで8080ポートをListenしているプロセスを特定し、タスクマネージャから終了することで対応した。
        </li> 
               
    </ol>
</ul>
<h2 id="createapi"><a class="anchor" href="#createapi"></a>4. REST APIの作成</h2>
<ul>
    <h3 id="initset"><a class="anchor" href="#initset"></a>4.1 初期設定</h2>
    <ul>
         <h3 id="configurepom"><a class="anchor" href="#configurepom"></a>4.1.1 pom.xmlの設定</h2>
        以下の定義をpom.xmlに設定する。
        <pre><code>
            &lt;dependency&gt;
                &lt;groupId&gt;com.github.dozermapper&lt;/groupId&gt;
                &lt;artifactId&gt;dozer-spring-boot-starter&lt;/artifactId&gt;
                &lt;version&gt;6.5.0&lt;/version&gt;
            &lt;/dependency&gt;
            ↑↑  オブジェクトからオブジェクトにデータをコピーするマッピングフレームワーク。
                コピー元からコピー先に同じ属性値がある限り、値をコピーする。この際、型が異なる場合は自動変換してくれる。
                通常、このような処理を行うにはgetterメソッドとsetterメソッドの呼び出しが必要だが、Dozerを利用することで
                コードを簡略化できる。  　　
            &lt;dependency&gt;
                &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
                &lt;artifactId&gt;mybatis-spring-boot-starter-test&lt;/artifactId&gt;
                &lt;version&gt;2.1.0&lt;/version&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
            ↑↑ MyBatisの機能をテストするライブラリ   
        </code></pre>
    </ul>
    <ul>
        <h3 id="configureyaml"><a class="anchor" href="#configureyaml"></a>4.1.2 application.ymlの設定</h2>  
            application.yamlでSpring Boot起動時に生成されるBeanの設定を変更することで、アプリケーションのプロパティ設定を行うことが出来る。
            ログ出力のプロパティ設定、トランザクションのプロパティ設定、データのプロパティ設定などを変更出来る。
            <br>
            参考：<a href="https://spring.pleiades.io/spring-boot/docs/current/reference/html/application-properties.html">アプリケーションプロパティ設定一覧</a>
            <br>
            今回は以下の通り、MybatisのSnakeCaseで定義されたカラム名をCamelCaseに変換(例：camel-case→camelCase)し、Formオブジェクトのプロパティ名とデータベースのカラム名をマッピングする設定を有効化する。
            (yaml形式で記述するため、src/main/resources/下にあるapplication.propertiesをapplication.ymlにリネームした上で設定を記述する。)
            <pre><code>
                mybatis:
                  configuration:
                    mapUnderscoreToCamelCase: true
            </code></pre>
    </ul>
</ul>

</div>
</div>
</body>
</html>